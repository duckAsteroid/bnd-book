version=pmwiki-2.1.18 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:8.0) Gecko/20100101 Firefox/8.0
author=
csum=
ctime=1287241934
host=90.41.123.119
name=Bnd.Download
rev=30
targets=Bnd.Maven,Bnd.Ant
text=(:title 02 Download:)%0a%0ahttp://www.aqute.biz/uploads/Code/bnd.png%0a%0a!02 Download%0a%0abnd is already used by several different projects.%0a%0a||[[http://njbartlett.name/bndtools.html|Bndtools]]||A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.||%0a||[[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Apache Maven Bundle Plugin]]||The plugin is based on bnd. You can find more information and tips at [[Maven]].||%0a||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]]||Ant/Eclipse plugin for OSGi development.||%0a||[[http://jaxenter.com/bnd4sbt-bnd-plugin-for-sbt-0-4-14804.html|Bnd4sbt]]||A bundle tool for Scala applications.||%0a||[[http://www.osmorc.org/|Osmorc]]||A plugin for IDEA's IntelliJ.||%0a||[[http://oss.intalio.com/buildr4osgi/index.html|Build4OSGi]]||A plugin for the JRuby based build tool [[http://buildr.apache.org/index.html|buildr]]||%0a||[[http://www.gradle.org/0.9-rc-1/docs/userguide/userguide_single.html#osgi_plugin|Gradle OSGi Plugin]]||A [[http://www.gradle.org|Gradle]] based OSGi plugin. Gradle is a Groovy based builder.||%0a||[[Ant]]||bnd is already an ant task||%0a||[[http://code.google.com/p/apache-felix-intellij-plugin/|Apache Felix IntelliJ Plugin]]||provides native IntelliJ IDEA support for developing, running and debugging OSGi projects developed using Apache Felix and the Apache Felix Maven Bundle Plugin. ||%0a%0aIf you're a developer of a tool that needs to be listed here, do not hesitate to [[mailto:Peter.Kriens@aQute.biz|ask me]].%0a%0a!!Source Code%0abnd is maintained at [[https://github.com/bndtools/bnd]]%0a%0a!!Maven Central%0aMaven Central may lag in its version but can be used with:%0a%0a  %3cdependency>%0a    %3cgroupId>biz.aQute%3c/groupId>%0a    %3cartifactId>bndlib%3c/artifactId>%0a    %3cversion>1.*.*%3c/version>%0a  %3c/dependency>%0a%0a!!Download Latest Version%0a%0a||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]]|| Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.||%0a||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar|biz.aQute.bnd.jar]]||An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. ||%0a||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]]||A library so you can use bnd in your own projects.||%0a%0aThe source code is contained in the bundles.%0a%0a(:includeurl http://dl.dropbox.com/u/2590603/bnd/release-notes.txt type="text/plain":)%0a
time=1319790623
title=02 Download
author:1319790623=
diff:1319790623:1312987662:=22,23c22,23%0a%3c bnd is maintained at [[https://github.com/bndtools/bnd]]%0a%3c %0a---%0a> bnd is maintained at [[http://www.github.com/bnd]]%0a> %0a
host:1319790623=90.41.123.119
author:1312987662=
diff:1312987662:1312987627:=17,18c17,18%0a%3c ||[[http://code.google.com/p/apache-felix-intellij-plugin/|Apache Felix IntelliJ Plugin]]||provides native IntelliJ IDEA support for developing, running and debugging OSGi projects developed using Apache Felix and the Apache Felix Maven Bundle Plugin. ||%0a%3c %0a---%0a> ||[[http://code.google.com/p/apache-felix-intellij-plugin/|Apache Felix Intellih Plugin||provides native IntelliJ IDEA support for developing, running and debugging OSGi projects developed using Apache Felix and the Apache Felix Maven Bundle Plugin. ||%0a> %0a
host:1312987662=90.37.27.254
author:1312987627=
diff:1312987627:1296122254:=17,18c17%0a%3c ||[[http://code.google.com/p/apache-felix-intellij-plugin/|Apache Felix Intellih Plugin||provides native IntelliJ IDEA support for developing, running and debugging OSGi projects developed using Apache Felix and the Apache Felix Maven Bundle Plugin. ||%0a%3c %0a---%0a> %0a
host:1312987627=90.37.27.254
author:1296122254=
diff:1296122254:1296122231:=21,22c21,22%0a%3c bnd is maintained at [[http://www.github.com/bnd]]%0a%3c %0a---%0a> bnd is maintained at [[http://www.github/bnd]]%0a> %0a
host:1296122254=82.174.105.216
author:1296122231=
diff:1296122231:1296122182:=20,22d19%0a%3c !!Source Code%0a%3c bnd is maintained at [[http://www.github/bnd]]%0a%3c %0a
host:1296122231=82.174.105.216
author:1296122182=
diff:1296122182:1288249553:=6a7%0a> %0a20,30c21,22%0a%3c !!Maven Central%0a%3c Maven Central may lag in its version but can be used with:%0a%3c %0a%3c   %3cdependency>%0a%3c     %3cgroupId>biz.aQute%3c/groupId>%0a%3c     %3cartifactId>bndlib%3c/artifactId>%0a%3c     %3cversion>1.*.*%3c/version>%0a%3c   %3c/dependency>%0a%3c %0a%3c !!Download Latest Version%0a%3c %0a---%0a> !!Download%0a> %0a
host:1296122182=82.174.105.216
author:1288249553=
diff:1288249553:1288249541:=12c12%0a%3c ||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]]||Ant/Eclipse plugin for OSGi development.||%0a---%0a> ||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]] - Ant/Eclipse plugin for OSGi development.||%0a
host:1288249553=90.41.125.248
author:1288249541=
diff:1288249541:1288249530:=12c12%0a%3c ||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]] - Ant/Eclipse plugin for OSGi development.||%0a---%0a> ||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]] - Ant/Eclipse plugin for OSGi development.%0a
host:1288249541=90.41.125.248
author:1288249530=
diff:1288249530:1288196705:=12d11%0a%3c ||[[http://felix.apache.org/site/sigil-key-features.html|Apache Felix Sigil]] - Ant/Eclipse plugin for OSGi development.%0a
host:1288249530=90.41.125.248
author:1288196705=
diff:1288196705:1288196655:=16,17c16%0a%3c ||[[Ant]]||bnd is already an ant task||%0a%3c %0a---%0a> %0a
host:1288196705=90.41.125.248
author:1288196655=
diff:1288196655:1288196641:=13c13%0a%3c ||[[http://www.osmorc.org/|Osmorc]]||A plugin for IDEA's IntelliJ.||%0a---%0a> |[[http://www.osmorc.org/|Osmorc]]||A plugin for IDEA's IntelliJ.||%0a
host:1288196655=90.41.125.248
author:1288196641=
diff:1288196641:1288196571:=10,16c10,16%0a%3c ||[[http://njbartlett.name/bndtools.html|Bndtools]]||A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.||%0a%3c ||[[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Apache Maven Bundle Plugin]]||The plugin is based on bnd. You can find more information and tips at [[Maven]].||%0a%3c ||[[http://jaxenter.com/bnd4sbt-bnd-plugin-for-sbt-0-4-14804.html|Bnd4sbt]]||A bundle tool for Scala applications.||%0a%3c |[[http://www.osmorc.org/|Osmorc]]||A plugin for IDEA's IntelliJ.||%0a%3c ||[[http://oss.intalio.com/buildr4osgi/index.html|Build4OSGi]]||A plugin for the JRuby based build tool [[http://buildr.apache.org/index.html|buildr]]||%0a%3c ||[[http://www.gradle.org/0.9-rc-1/docs/userguide/userguide_single.html#osgi_plugin|Gradle OSGi Plugin]]||A [[http://www.gradle.org|Gradle]] based OSGi plugin. Gradle is a Groovy based builder.||%0a%3c %0a---%0a> * [[http://njbartlett.name/bndtools.html|Bndtools]] - A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.%0a> * [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Apache Maven Bundle Plugin]] - The plugin is based on bnd. You can find more information and tips at [[Maven]].%0a> * [[http://jaxenter.com/bnd4sbt-bnd-plugin-for-sbt-0-4-14804.html|Bnd4sbt]] - A bundle tool for Scala applications.%0a> * [[http://www.osmorc.org/|Osmorc]] - A plugin for IDEA's IntelliJ.%0a> * [[http://oss.intalio.com/buildr4osgi/index.html|Build4OSGi]] - A plugin for the JRuby based build tool [[http://buildr.apache.org/index.html|buildr]]%0a> * [[http://www.gradle.org/0.9-rc-1/docs/userguide/userguide_single.html#osgi_plugin|Gradle OSGi Plugin]] - A [[http://www.gradle.org|Gradle]] based OSGi plugin. Gradle is a Groovy based builder.%0a> %0a
host:1288196641=90.41.125.248
author:1288196571=
diff:1288196571:1288196418:=17,20c17%0a%3c If you're a developer of a tool that needs to be listed here, do not hesitate to [[mailto:Peter.Kriens@aQute.biz|ask me]].%0a%3c %0a%3c !!Download%0a%3c %0a---%0a> %0a
host:1288196571=90.41.125.248
author:1288196418=
diff:1288196418:1288196278:=15,17c15,16%0a%3c * [[http://www.gradle.org/0.9-rc-1/docs/userguide/userguide_single.html#osgi_plugin|Gradle OSGi Plugin]] - A [[http://www.gradle.org|Gradle]] based OSGi plugin. Gradle is a Groovy based builder.%0a%3c %0a%3c %0a---%0a> %0a> %0a
host:1288196418=90.41.125.248
author:1288196278=
diff:1288196278:1288195650:=14,16c14,15%0a%3c * [[http://oss.intalio.com/buildr4osgi/index.html|Build4OSGi]] - A plugin for the JRuby based build tool [[http://buildr.apache.org/index.html|buildr]]%0a%3c %0a%3c %0a---%0a> %0a> %0a
host:1288196278=90.41.125.248
author:1288195650=
diff:1288195650:1288195575:=10,11c10%0a%3c * [[http://njbartlett.name/bndtools.html|Bndtools]] - A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.%0a%3c * [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Apache Maven Bundle Plugin]] - The plugin is based on bnd. You can find more information and tips at [[Maven]].%0a---%0a> * [[http://njbartlett.name/bndtools.html|bndtools]] - A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.%0a13,15c12,14%0a%3c * [[http://www.osmorc.org/|Osmorc]] - A plugin for IDEA's IntelliJ.%0a%3c %0a%3c %0a---%0a> * [[http://www.osmorc.org/|osmorc]] - A plugin for IDEA's IntelliJ.%0a> %0a> %0a
host:1288195650=90.41.125.248
author:1288195575=
diff:1288195575:1287411750:=6,14d5%0a%3c %0a%3c %0a%3c bnd is already used by several different projects.%0a%3c %0a%3c * [[http://njbartlett.name/bndtools.html|bndtools]] - A plugin for Eclipse that is completely based on bnd. It is available in the Eclipse marketplace.%0a%3c * [[http://jaxenter.com/bnd4sbt-bnd-plugin-for-sbt-0-4-14804.html|Bnd4sbt]] - A bundle tool for Scala applications.%0a%3c * [[http://www.osmorc.org/|osmorc]] - A plugin for IDEA's IntelliJ.%0a%3c %0a%3c %0a
host:1288195575=90.41.125.248
author:1287411750=
diff:1287411750:1287248495:=7c7%0a%3c ||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar|biz.aQute.bnd.jar]]||An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. ||%0a---%0a> ||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]]||An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. ||%0a
host:1287411750=90.41.247.141
author:1287248495=
diff:1287248495:1287246226:=1,2c1%0a%3c (:title 02 Download:)%0a%3c %0a---%0a> (:title 02 Download::)%0a5c4%0a%3c !02 Download%0a---%0a> !Downloads%0a
host:1287248495=90.41.247.141
author:1287246226=
diff:1287246226:1287244905:=1c1%0a%3c (:title 02 Download::)%0a---%0a> (:title 01 Downloads::)%0a
host:1287246226=90.41.247.141
author:1287244905=
diff:1287244905:1287244812:=11c11%0a%3c (:includeurl http://dl.dropbox.com/u/2590603/bnd/release-notes.txt type="text/plain":)%0a---%0a> (:includeurl http://dl.dropbox.com/u/2590603/bnd/release-notes.txt:)%0a
host:1287244905=90.41.247.141
author:1287244812=
diff:1287244812:1287244766:=5,8c5,8%0a%3c ||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]]|| Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.||%0a%3c ||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]]||An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. ||%0a%3c ||[[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]]||A library so you can use bnd in your own projects.||%0a%3c %0a---%0a> * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]] - Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.%0a> * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]] - An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. %0a> * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]] - A library so you can use bnd in your own projects.%0a> %0a
host:1287244812=90.41.247.141
author:1287244766=
diff:1287244766:1287244745:=11c11%0a%3c (:includeurl http://dl.dropbox.com/u/2590603/bnd/release-notes.txt:)%0a---%0a> (:includeurl http://dl.dropbox.com/u/2590603/release-notes.txt:)%0a
host:1287244766=90.41.247.141
author:1287244745=
diff:1287244745:1287244646:=11c11%0a%3c (:includeurl http://dl.dropbox.com/u/2590603/release-notes.txt:)%0a---%0a> (:includeurl http://dl.dropbox.com/u/2590603/bnd-release-notes.txt:)%0a
host:1287244745=90.41.247.141
author:1287244646=
diff:1287244646:1287243896:=5,8c5,8%0a%3c * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]] - Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.%0a%3c * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]] - An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. %0a%3c * [[http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]] - A library so you can use bnd in your own projects.%0a%3c %0a---%0a> * [[http://dl.dropbox.com/u/2590603/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]] - Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.%0a> * [[http://dl.dropbox.com/u/2590603/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]] - An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. %0a> * [[http://dl.dropbox.com/u/2590603/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]] - A library so you can use bnd in your own projects.%0a> %0a
host:1287244646=90.41.247.141
author:1287243896=
diff:1287243896:1287243551:=
host:1287243896=90.41.247.141
author:1287243551=
diff:1287243551:1287241993:=10,11d9%0a%3c %0a%3c (:includeurl http://dl.dropbox.com/u/2590603/bnd-release-notes.txt:)%0a
host:1287243551=90.41.247.141
author:1287241993=
diff:1287241993:1287241958:=9a10,840%0a> %0a> I strongly suggest to use [[http://github.com/njbartlett/bndtools|bndtools]] from Neil Bartlett because this puts a very pretty Eclipse GUI on top of bnd.%0a> %0a> ''How to pronounce and write bnd? bnd should be written with lower case characters because it is only modest tool. You pronounce it as be-and-de.''%0a> %0a> If you have questions about bnd then you can discuss these on the bndtools mailinglist: [[http://groups.google.com/group/bndtools-users|groups.google.com/group/bndtools-users]]. %0a> %0a> !!Articles about bnd%0a> * Introduction into bnd by Costin Leau, [[http://blog.springsource.com/main/2008/02/18/creating-osgi-bundles/|Creating OSGi bundles]]%0a> * [[http://www.aqute.biz/Blog/2007-05-21|Why you need bnd]]%0a> * [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Felix Maven Plugin based on bnd]]%0a> *  [[BndCn|Chinese version]]%0a> %0a> !! Introduction%0a> %0a> The bnd tool helps you create and diagnose OSGi R4 bundles. The key functions are:%0a> %0a> * Show the manifest and JAR contents of a bundle%0a> * Wrap a JAR so that it becomes a bundle%0a> * Create a Bundle from a specification and a class path%0a> * Verify the validity of the manifest entries%0a> %0a> The tool is capable of acting as:%0a> %0a> * [[#cmd|Command line tool]]%0a> * [[#eclipse|Eclipse Plugin]]%0a> * [[#maven|Maven Plugin]]%0a> * [[#ant|Ant Plugin]]%0a> %0a> Table Of Contents%0a> * [[#background|Background]]%0a> * [[#format|File format]]%0a> * [[#directives|Directives]]%0a> * [[#macros|Use of macros]]%0a> %0a> [[#background]]%0a> !!Background%0a> Traditionally, JAR files are made with the SUN jar tool, the jar ant task, or the Maven packager. All these tools share the same concept. The developer creates a directory image of the jar by copying files to a directory; this directory is then jarred. Obviously this method works well.%0a> %0a> The Bnd tool works different, it recognizes Java classes and packages and constructs the JAR from the classpath. It can create a JAR from packages the sources, directories or other JAR files. You never have to copy files around, the instructions that Bnd receives are sufficient to retrieve the files from their original location, preprocessing or filtering when required.%0a> %0a> The Jar is constructed from 3 different arguments:%0a> %0a>   Export-Package%0a>   Private-Package%0a>   Include-Resource%0a> %0a> Private-Package and Export-Package contain ''instructions''. Instructions are patterns + attributes and directives, looking like normal OSGi attributes and directives. For example:%0a> %0a>   Export-Package: com.acme.*;version=1.2%0a> %0a> Each instruction is applied to each package on the classpath in the definition order. That is, if an earlier instruction matches, the later instruction never gets a chance to do its work. If an instruction matches its attributes and properties are applied to the packages. The difference between the Private-Package argument and the Export-Package arguments is that the export version selects the packages for export. If the packages overlap between the two, the export wins.%0a> %0a> An instruction can also be negative when it starts with a '!'. In that case the package is excluded from the selection. For example:%0a> %0a>   Export-Package: !com.acme.impl, com.acme.*;version=1.2%0a> %0a> Note that the instructions are applied in order. If the ! instruction was at the end in the previous example, it would not have done its work because the com.acme.* would already have matched.%0a> %0a> The Include-Resource argument can be used to copy resources from the file system in the JAR. This is useful for licenses, images, etc. The instructions in the argument can be a directory, a file, or an inline JAR. The default JAR path is the the root for a directory or the filename for a file. The path can be overridden. Instructions that are enclosed in curly braces, like {license.txt}, are pre-processed, expanding any macros in the file.%0a> %0a> Once the JAR is created, the bnd program analyzes the classes and creates an import list with all the packages that are not contained in the jar but which are referred to. This import list is matched against the Import-Package instructions. Normally, the Import-Package argument is *; all referred packages will be imported. However, sometimes it is necessary to ignore an import or provide attributes on the import statement. For example, make the import optional or discard the import:%0a> %0a>   Import-Package: !com.acme.*, *;resolution:=optional%0a> %0a> The arguments to bnd are normal given as a set of properties. Properties that begin with an upper case are copied to the manifest (possibly after processing). Lower case properties are used for macro variables but are not set as headers in the manifest.%0a> %0a> After the JAR is created, the bnd program will verify the result. This will check the resulting manifest in painstaking detail.%0a> %0a> The bnd program works on a higher level then traditional jarring; this might take some getting used to. However, it is much more elegant to think in packages than that it is to think in files. The fact that Bnd understand the semantics of a bundle allows it to detect many errors and allows bundles to be created with almost no special information. %0a> %0a> Bnd will not create an output file if none of the resources is newer than an existing output file.%0a> %0a> The program is available in several forms: command line, ant task, maven plugin, and an Eclipse plugin.%0a> %0a> [[#quick]]%0a> !!Quick Start%0a> %0a> Assume we need to create a bundle in Eclipse. Each Java project in Eclipse has a set of sources and a class path. Bnd therefore knows, about all the classes. However, it does not know how you want to structure your JARs/Bundles. It therefore needs a description file, the ''bnd file''. If you create such a file, you should give it the same as name as the bundle symbolic name with a @@.bnd@@ extension. For example @@aQute.example.bnd@@ is a well chosen name. If the name is not @@bnd.bnd@@, the file name without the .bnd extension is the default for your bundle symbolic name.%0a> %0a> Lets build a bundle for the aQute OSGi tutorial Chat example. This bundle has 2 packages.%0a> %0a> * aQute.service.channel%0a> * aQute.tutorial.chat%0a> %0a> The @@aQute.service.channel@@ package must be exported and the other package may remain private. All packages that are referred from the source code must be imported. To achieve this, the following manifest will suffice:%0a> %0a>   Export-Package: aQute.service.channel; version=1.0 %0a>   Private-Package: aQute.tutorial.chat%0a> %0a> This is all you need! In Eclipse, you can select the bnd file and run the @@Make Bundle@@ command. This will create a JAR with the proper content:%0a> %0a>  META-INF %0a>    MANIFEST.MF %0a>  aQute/service/channel %0a>    Channel.class %0a>    aQute/tutorial/chat %0a>    Chat$ChannelTracker.class %0a>    Chat.class%0a> %0a> You can run the same command from the command line%0a> %0a>  bnd aQute.tutorial.chat.bnd%0a> %0a> Now take a look at the JAR file's manifest. With the command line version of you can do this with @@bnd aQute.tutorial.chat.jar@@. Otherwise just open the JAR with WinZip.%0a> %0a>  Manifest-Version: 1%0a>  Bundle-Name: aQute.tutorial.chat%0a>  Private-Package: aQute.tutorial.chat%0a>  Import-Package: aQute.service.channel;version=1.0,%0a>    org.osgi.framework; version=1.3,%0a>    org.osgi.util.tracker;version=1.3%0a>  Bundle-ManifestVersion: 2%0a>  Bundle-SymbolicName: aQute.tutorial.chat%0a>  Export-Package: aQute.service.channel;version=1.0%0a>  Bundle-Version: 0%0a> %0a> As you can see, bnd filled in a number of headers. The first header, Manifest-Version is required by the JAR standard. Bundle-Name is derived from the Bundle-SymbolicName because we did not specify it. The Private-Package header specifies the packages that ended up not exported. The Import-Package header comes from the packages that were referred to from the contained packages (private and exported). As you can see, bnd picked up versions for the imported packages. These versions come from the manifest of the JARs that source these packages, or from the packageinfo file. The Export-Package shows the export of the service package. On top of this, bnd has verified that all your headers really match the OSGi specifications, or you will get errors and warnings.%0a> %0a> [[#format]]%0a> !!Bnd file format%0a> %0a> The bnd format is very similar to the manifest. Though it is read with the Properties class, you can actually use the ':' as separator to make it look more like a manifest file. The only thing you should be aware of is that the line continuation method of the Manifest (a space as the first character on the line) is not supported. Line continuations are indicated with the backslash ('\' \u005C) as the last character of the line. Lines may have any length. You can add comments with a # on the first character of the line:%0a> %0a>   # This is a comment%0a> %0a> White spaces around the key and value are trimmed. See [[http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html |  Properties]] for more information about the format.%0a> %0a> There are different instructions in the properties file:%0a> %0a> ||%0a> ||!Type ||!Example ||!Description ||%0a> ||Manifest headers ||Bundle-Description: ... ||When the first character is a upper case character. These headers are copied to the manifest or augmented by bnd. ||%0a> ||Variables ||version=3.0 ||Variables are lower case headers. Headers can contain references to other headers using macro expansion. Variables are not copied to the manifest. See [[#macros|Macros]] ||%0a> ||Directives ||-include: deflts.bnd ||Directives start with a '-' sign. A directive is an instruction to bnd to do something special. See [[#directives|Directives]] ||%0a> %0a> [[#directives]]%0a> !! Bnd Directives%0a> %0a> ||%0a> ||!Instruction ||!Format ||!Description ||%0a> ||@@-classpath@@||[[#list | LIST]] ||Add the listed files to the current class path. The files must be addressed relative to the properties file. The files must be either a JAR file or a directory. For example:\\%0a> @@-classpath= acme.jar, junit.jar, bin@@ ||%0a> ||@@-debug@@||@@true|false@@||Generate debugging information. This will save embedded jar files in the target directory when they are generated on the fly.||%0a> ||@@-donotcopy@@||[[#regex | REGEX]] ||During copying of files from the classpath, file system, or other places, this filter is used to prevent copies. For example, normally @@CVS@@ and @@.svn@@ directories should not be copied. The default is therefore @@(CVS|.svn)@@. Example:  \\%0a> @@-donotcopy= (CVS|.svn|.+.bak|~.+)@@ ||%0a> ||-include ||[[#list | LIST]] ||This property will include the list of files in the given order. The files are relative from the bnd file itself. If this directive is used inside an included properties file, then the including file is the base. Includes are very useful to keep headers like Bundle-Vendor, Bundle-Copyright central. If the extension of the file is .mf, then the file is parsed as a manifest file. By default, a property defined in an include file override earlier definitions, this implies that any property in the bnd file is overridden if defined in an include file. The include files are read in the order they are listed where later files override earlier files. If there are multiple definitions for the same property, then the last definitions wins. If the path of an included file starts with a ~, then it will '''not''' override earlier set properties.\\%0a> You can use properties like ${user.home} in file names. If the file does not exist, an error is generated. If the filename is prefixed with a '-' sign then no error is generated when the file is absent. For example:  \\%0a> \\%0a> @@-include= ~${user.home}/deflts.bnd, META-INF/MANIFEST.MF@@\\%0a> @@-include= a.props, ~META-INF/MANIFEST.MF@@ ||%0a> ||@@-nope@@||true|false||Do not build a bundle||%0a> ||@@-exportcontents@@||[[#LIST|LIST]] of [[#PATTERN | PATTERN]]||The content of this header augments the Export-Package header, but only for the manifest calculation. That is, Export-Package is used to calculate the contents of the JAR, but then this instruction can be used change or add instructions for the manifest generation.||%0a> ||-failok ||true | false ||In certain cases, errors should not abort the creation of the bundle. For example test cases often require the creation of an invalid JAR. If this flag is set to true, errors will create a target bundle (when possible) and errors are only listed. When failok is false, the default, any error will not create a target bundle and will delete the bundle file. Example:  \\%0a> @@-failok= true@@ ||%0a> ||@@-manifest@@||FILE||Overrides the generation of a manifest and uses the given file instead.||%0a> ||@@-nomanifest@@||false|true||Generate a JAR without a manifest||%0a> ||@@-output@@||PATH||Store the file (if applicable) under the path||%0a> ||@@-removeheaders@@||[[#LIST|LIST]] of string||Removes the given headers from the output manifest. This feature can be useful if you are wrapping a bundle and it contains for example a Require-Bundle header.||%0a> ||@@-nouses@@||@@true|false@@||Do not calculate the @@uses:@@ directive.||%0a> ||@@-plugin@@||[[#LIST|LIST]] of [[#PLUGIN|PLUGIN]]||Define the plugins that bnd should use. A plugin is a class that is used at certain phases in the bundle generation. That place is defined by the interfaces it implements. Plugins are defined in [[#plugins|plugins]].||%0a> ||@@-sources@@||@@true|false@@||Include sources||%0a> ||@@Export-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Export-Package header lists the packages that the bundle should export, and thus contain. [[#export-package|See ExportPackage]].||%0a> ||@@Include-Resource@@||[[#LIST|LIST]] of iclause||The Include-Resource instruction makes it possible to include arbitrary resources; it contains a list of resource paths. [[#include-resource|See Include Resource]].||%0a> ||@@Private-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Private-Package header lists the packages that the bundle should contain but not export. [[#private-package|See Private Package]].||%0a> ||@@Import-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Import-Package header lists the packages that are required by the contained packages. [[#import-package|See Import Package]].||%0a> ||@@Conditional-Package@@||[[#LIST|LIST]] of [[#PATTERN|PATTERN]] || '''experimental''' Works as private package but will only include the packages when they are imported. When this header is used, bnd will recursively add packages that match the patterns until there are no more additions.||%0a> ||@@Bundle-\\%0a> SymbolicName@@|| ||The Bundle-SymbolicName header can be set by the user. The default is the name of the main bnd file, or if the main bnd file is called bnd.bnd, it will be the name of the directory of the bnd file. An interesting variable is ${project} that will be set to this default name. ||%0a> ||@@Bundle-Name@@|| ||If the Bundle-Name is not set, it will default to the Bundle-SymbolicName. ||%0a> ||@@Bundle-\\%0a> ManifestVersion@@||2 ||The Bundle-ManifestVersion is always set to 2, there is no way to override this. ||%0a> ||@@Bundle-Version@@||VERSION ||The version of the bundle. If no such header is provided, a version of 0 will be set. ||%0a> ||@@Service-Component@@||[[#LIST | LIST]] of @@component@@ || See [[#component|Service Component Header]].||%0a> %0a> %0a> !!Basic Types%0a> ||[[#list]][[#LIST]]LIST||A comma separated list. Items should be quoted with '"' if the contain commas. In general, a list item can also define attributes and directives on an item.||%0a> ||[[#pattern]][[#PATTERN]]PATTERN||A pattern matches some entity: a package, a directory, etc. Patterns are based on Java regular expressions but are preprocessed before compiled. Any dots ('.') are replaced with \. to make them match the input and not act as the 'any character' operator. Any '?' or '*' is prefixed with a dot to make it match any character. As an extra convenience, if the string ends with \..*, an additional pattern is added to match the complete string with out the \..*. The effect is that something like com.acme.* matches com.acme and all its sub packages. It is also to negate a pattern by prefixing it with an exclamation mark ('!'). For example:\\%0a>    @@Import-Package: !com.sun.*, *@@ \\%0a> indicates that any imports to com.sun should not be imported.||%0a> ||[[#regex]]REGEX||A regular expressions||%0a> %0a> %0a> [[#export-package]]%0a> !!Export-Package%0a> The bnd definition allows the specification to be done using ''patterns'', a modified regular expression. All patterns in the definition are matched against every package on the [[#CLASSPATH | class path]]. If the pattern is a negating pattern (starts with !) and it is matched, then the package is completely excluded. Normal patterns cause the package to be included in the resulting bundle. Patterns can include both directives and attributes, these items will be copied to the output. The list is ordered, earlier patterns take effect before later patterns. The following examples copies everything on the class path except for packages starting with @@com@@. The default for Export-Package is "*", which can result in quite large bundles. If the source packages have an associated version (from their manifest of packageinfo file), then this version is automatically added to the clauses.%0a> %0a>   Export-Package= !com.*, *%0a> %0a> Exports are automatically imported. This features can be disabled with a special directive on the export instruction: @@-noimport:=true@@. For example:%0a>   %0a>   Export-Package= com.acme.impl.*;-noimport:=true, *%0a> %0a> Bnd will automatically calculate the @@uses:@@ directive. This directive is used by the OSGi framework to create a consistent class space for a bundle. The Export-Package statement allows this directive to be overridden on a package basis by specifying the directive in an Export-Package instruction. %0a> %0a>   Export-package = com.acme.impl.*;uses="my.special.import"%0a> %0a> However, in certain cases it is necessary to augment the uses clause. It is therefore possible to use the special name @@%3c%3cUSES>>@@ in the clause. Bnd will replace this special name with the calculated uses set. Bnd will remove any extraneous commas when the @@%3c%3cUSES>>@@ is empty.%0a> %0a>   Export-package = com.acme.impl.*;uses="my.special.import,%3c%3cUSES>>"%0a> %0a> !!!Split packages%0a> Bnd traverse the packages on the classpath and copies them to the output based on the instructions given by the Export-Package and Private-Package headers. This opens up for the possibility that there are multiple packages with the same name on the class path. It is better to avoid this situation because it means there is no cohesive definition of the package and it is just, eh, messy. However, there are valid cases that packages should be merged from different sources. For example, when a standard package needs to be merged with implementation code like the osgi packages sometimes (unfortunately) do. Without any extra instructions, bnd will merge multiple packages where the last one wins if the packages contain duplicate resources, but it will give a warning to notify the unwanted case of split packages.%0a> %0a> The @@-split-package:@@ directive on the Export-Package/Private-Package clause allows fine grained control over what should be done with split packages. The following values are architected:%0a> %0a> ||@@merge-first@@||Merge split packages but do not add resources that come later in the classpath. That is, the first resource wins. This is the default, although the default will generate a warning||%0a> ||@@merge-last@@||Merge split packages but overwrite resources that come earlier in the classpath. That is, the last resource wins.||%0a> ||@@first@@||Do not merge, only use the first package found||%0a> ||@@error@@||Generate an error when a split package is detected||%0a> %0a> For example:%0a> %0a>   Private-Package: test.pack;-split-package:=merge-first%0a> %0a> %0a> %0a> %0a> [[#private-package]]%0a> !!Private Package%0a> The method of inclusion is identical to the Export-Package header, the only difference is, is that these packages are not exported. This header will be copied to the manifest. If a package is selected by noth the export and private package headers, then the export takes precedence.%0a> %0a>   Private-Package= com.*%0a> %0a> [[#import-package]]%0a> !!Import Package%0a> The Import-Package header lists the packages that are required by the contained packages. The default for this header is "*", resulting in importing all referred packages. This header therefore rarely has to be specified. However, in certain cases there is an unwanted import. The import is caused by code that the author knows can never be reached. This import can be removed by using a negating pattern. A pattern is inserted in the import as an extra import when it contains no wildcards and there is no referral to that package. This can be used to add an import statement for a package that is not referred to by your code but is still needed, for example, because the class is loaded by name.%0a> %0a> For example:%0a>   Import-Package: !org.apache.commons.log4j, com.acme.*,%0a>      com.foo.extra%0a> %0a> During processing, bnd will attempt to find the exported version of imported packages. If no version or version range is specified on the import instruction, the exported version will then be used though the micro part and the qualifier are dropped. That is, when the exporter is @@1.2.3.build123@@, then the import version will be 1.2. If a specific version (range) is specified, this will override any found version. This default an be overridden with the [[#versionpolicy|-versionpolicy]] command.%0a> %0a> If an explicit version is given, then ${@} can be used to substitute the found version in a range. In those cases, the version macro can be very useful to calculate ranges or drop specific parts of the version. For example:%0a> %0a>   Import-Package: org.osgi.framework;version="[1.3,2.0)"%0a>   Import-Package: org.osgi.framework;version=${@}%0a>   Import-Package: org.osgi.framework;version="[${version;==;${@}},${version;=+;${@}})"%0a> %0a> If an imported package uses mandatory attributes, then bnd will attempt to add those attributes to the import statement. However, in certain (bizarre!) cases this is not wanted. It is therefore possible to remove an attribute from the import clause. This is done with the @@-remove-attribute:@@ directive or by setting the value of an attribute to !. The parameter of the @@-remove-attribute@@ directive is an instruction and can use the standard options with !, *, ?, etc.%0a> %0a>   Import-Package: org.eclipse.core.runtime;-remove-attribute:common,*%0a> %0a> Or%0a> %0a>   Import-Package: org.eclipse.core.runtime;common=!,*%0a> %0a> %0a> [[#include-resource]]%0a> !!Include Resource%0a> The resources will be copied into the target jar file. The iclause can have the following forms:%0a> %0a>   iclause    ::= inline | copy%0a>   copy       ::= '{' process '}' | process%0a>   process    ::= assignment | simple%0a>   assignment ::= PATH '=' simple%0a>   simple     ::= PATH parameter*%0a>   inline     ::= '@' PATH ( '!/' PATH? ('/**' | '/*')? )?%0a>   parameters ::= 'flatten' | 'recursive' | 'filter'%0a> %0a> In the case of @@assignment@@ or @@simple@@, the PATH parameter can point to a file or directory. It is also possible to use the name.ext path of a JAR file on the classpath, that is, ignoring the directory. The @@simple@@ form will place the resource in the target JAR with only the file name, therefore without any path components. That is, including src/a/b.c will result in a resource b.c in the root of the target JAR. %0a> %0a> If the PATH points to a directory, the directory name itself is not used in the target JAR path. If the resource must be placed in a subdirectory of the target jar, use the @@assignment@@ form. If the file is not found, bnd will traverse the classpath to see of any entry on the classpath matches the given file name (without the directory) and use that when it matches. The @@inline@@ requires a ZIP or JAR file, which will be completely expanded in the target JAR (except the manifest), unless followed with a file specification. The file specification can be a specific file in the jar or a directory followed by ** or *. The ** indicates recursively and the * indicates one level. If just a directory name is given, it will mean **.%0a> %0a> The @@simple@@ and @@assigment@@ forms can be encoded with curly braces, like @@{foo.txt}@@. This indicates that the file should be preprocessed (or filtered as it is sometimes called). Preprocessed files can use the same variables and macros as defined in the [[#macros|macro section]].%0a> %0a> The @@recursive:@@ directive indicates that directories must be recursively included.%0a> %0a> The @@flatten:@@ directive indicates that if the directories are recursively searched, the output must not create any directories. That is all resources are flattened in the output directory.%0a> %0a> The @@filter:@@ directive is an optional filter on the resources. This uses the same format as the instructions. Only the file name is verified against this instruction.%0a> %0a>  Include-Resource: @osgi.jar,%0a>     {LICENSE.txt},%0a>     acme/Merge.class=src/acme/Merge.class%0a> %0a> %0a> %0a> [[#plugins]]%0a> !!!Plugins%0a> Plugins are objects that can extend the functionality of bnd. They are called from inside bnd when a certain action should take place. For example, bnd uses a repository and plugins provide the actual repository implementations. Or for example, the SpringComponent analyzes the Spring files and adds references found in that XML to the imports.%0a> %0a> A plugin is defined as:%0a> %0a>   PLUGIN ::= FQN ( ';' %3cdirective|attribute> )*%0a> %0a> The following directive is defined for all plugin:%0a> %0a> ||@@path:@@ ||A path to the jar file that contains the plugin||%0a> %0a> bnd current supports the following plugin types:%0a> %0a>   /**%0a>    * An optional interface for plugins. If a plugin implements %0a>    * this interface then it can receive the remaining attributes %0a>    * and directives given in its clause as%0a>    * well as the reporter to use.%0a>    */%0a>   public interface Plugin {%0a>     /**%0a>      * Give the plugin the remaining properties.%0a>      * When a plugin is declared, the clause can contain %0a>      * extra properties. All the properties and directives %0a>      * are given to the plugin to use.%0a>      * @param map attributes and directives for this plugin's clause%0a>      */%0a>     void setProperties(Map%3cString,String> map);%0a>     %0a>     /**%0a>      * Set the current reporter. This is called at init time. %0a>      * This plugin should report all errors and warnings %0a>      * to this reporter.%0a>      * @param processor%0a>      */%0a>     void setReporter(Reporter processor);%0a>  }%0a> %0a>   public interface AnalyzerPlugin {%0a>     /**%0a>      * This plugin is called after analysis. The plugin %0a>      * is free to modify the jar and/or change the classpath %0a>      * information (see referred, contained).%0a>      * This plugin is called after analysis of the JAR %0a>      * but before manifest generation.%0a>      * %0a>      * @param analyzer%0a>      * @return true if the classpace has been modified so that the bundle%0a>      *         classpath must be reanalyzed%0a>      * @throws Exception%0a>      */%0a>     boolean analyzeJar(Analyzer analyzer) throws Exception;%0a>   }%0a> %0a>   public interface SignerPlugin {%0a>     /**%0a>      * Sign the current jar. The alias is the given certificate %0a>      * keystore.%0a>      * %0a>      * @param builder   The current builder that contains the %0a>                         jar to sign%0a>      * @param alias     The keystore certificate alias%0a>      * @throws Exception When anything goes wrong%0a>      */%0a>     void sign(Builder builder, String alias) throws Exception;%0a>   }%0a> %0a>   public interface RepositoryPlugin {%0a>     /**%0a>      * Return a URL to a matching version of the given bundle.%0a>      * %0a>      * @param bsn%0a>      *            Bundle-SymbolicName of the searched bundle%0a>      * @param range%0a>      *            Version range for this bundle,"latest" %0a>      *            if you only want the%0a>      *            latest, or null when you want all.%0a>      * @return    A list of URLs sorted on version, lowest version %0a>      *            is at index 0.%0a>      *            null is returned when no files with the given %0a>      *            bsn ould be found.%0a>      * @throws Exception%0a>      *             when anything goes wrong%0a>      */%0a>     File[] get(String bsn, String range) throws Exception;%0a>     %0a>     /**%0a>      * Answer if this repository can be used to store files.%0a>      * %0a>      * @return true if writable%0a>      */%0a>     boolean canWrite();%0a>     %0a>     /**%0a>      * Put a JAR file in the repository.%0a>      * %0a>      * @param jar%0a>      * @throws Exception%0a>      */%0a>     File  put(Jar jar) throws Exception;%0a>     %0a>     /**%0a>      * Return a list of bsns that are present in the repository.%0a>      * %0a>      * @param  regex if not null, match against the bsn and if %0a>      *         matches, return otherwise skip%0a>      * @return A list of bsns that match the regex parameter %0a>      *         or all if regex is null%0a>      */%0a>     List%3cString> list(String regex);%0a>     %0a>     /**%0a>      * Return a list of versions.%0a>      */%0a>     %0a>     List%3cVersion> versions(String bsn);%0a>   }%0a> %0a>   public interface MakePlugin {%0a> %0a>     /**%0a>      * This plugin is called when Include-Resource detects %0a>      * a reference to a resource that it can not find in the %0a>      * file system.%0a>      * %0a>      * @param builder   The current builder%0a>      * @param source    The source string (i.e. the place %0a>      *                  where bnd looked)%0a>      * @param arguments Any arguments on the clause in %0a>      *                  Include-Resource%0a>      * @return          A resource or null if no resource %0a>      *                  could be made%0a>      * @throws Exception%0a>      */%0a>     Resource make(Builder builder, String source, %0a>           Map%3cString,String> arguments) throws Exception;%0a>   }%0a> %0a> [[#make]]%0a> !!!Make%0a> Make plugins kick in when the @@Include-Resource@@ header tries to locate a resource but it cannot find that resource. The @@-make@@ option defines a number of patterns that are mapped to a make instruction.%0a> %0a> For example, if you have%0a> %0a>   Include-Resource:       com.acme.Abc.ann%0a> %0a> If no such resource is found, bnd will look in the -make instruction. This instruction associates a pattern with a plugin type. For example:%0a> %0a>        -make:                  (*.jar); type=xyz; abc=3; def="$1"%0a> %0a> The first name part of the clause is matched against the unfound resource. All plugins are called sequentially until one returns non-null. The arguments on the -make clause are given as parameters to the make plugin. Normally all Make Plugins should verify the type field.%0a> %0a> bnd has a bnd and a copy Make Plugin.%0a> %0a> !!!Buildin Plugins%0a> Some plugins are provided by bnd itself.%0a> %0a> ||aQute.lib.spring.SpringComponent||AnalyzerPlugin||This component will analyze the Spring XML for Spring DM and will add any classes in these files to the referred set of classes.||%0a> ||aQute.bnd.make.MakeBnd||MakePlugin||If Include-Resource can't find a referred resource it will use the make plugins to see if any of them can make the requested resource. The MakeBnd has type=bnd. This plugin can recursively call bnd to create embedded jars that are not created sequentially||%0a> ||aQute.bnd.make.MakeCopy||MakePlugin||Copies resources from other places in the file system||%0a> ||aQute.lib.deployer.FileRepo||RepositoryPlugin||Provides a file based repository.||%0a> ||aQute.bnd.maven.MavenRepository||RepositoryPlugin||Provides an interface to a the default maven repository in the user's home directory. Can be used with aQute.bnd.maven.MavenGroup to support converting bundle symbolic names to group and artifact id.||%0a> %0a> [[#component]]%0a> !!!Service-Component Header%0a> The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations. %0a> %0a> The syntax for these component definitions is:%0a> %0a>   component ::= %3cname> ( ';' parameter ) * %0a>   parameter ::= provide | reference | multiple | optional%0a>               | reference | properties | factory | servicefactory%0a>               | immediate | enabled | implementation %0a>               | activate | deactivate | modified | configuration-policy%0a>               | version%0a>   reference ::= %3cname> '=' %3cinterface-class> %0a>                  ( '(' %3ctarget-filter> ')')? cardinality?%0a>   cardinality ::= '?' | '*' | '+' | '~'%0a>   provide  ::= 'provide:=' LIST %0a>   multiple  ::= 'multiple:=' LIST %0a>   optional  ::= 'optional:=' LIST %0a>   dynamic   ::= 'dynamic:=' LIST%0a>   factory   ::= 'factory:=' true | false%0a>   servicefactory := 'servicefactory:=' true | false%0a>   immediate ::= 'immediate:=' true | false%0a>   enabled   ::= 'enabled:=' true | false%0a>   configuration-policy ::= "configuration-policy:=' ( 'optional' | 'require' | 'ignore' )%0a>   activate  ::= 'activate:=' METHOD%0a>   modified  ::= 'activate:=' METHOD%0a>   deactivate::= 'activate:=' METHOD%0a>   implementation::= 'implementation:=' %3cimplementation-class>%0a>   properties::= 'properties:=' key '=' value  [=\=]%0a>                 ( ',' key '=' value ) *%0a> %0a> If the name of the component maps to a resource, or ends in XML, or there are attributes set, then that clause is copied to the output Service-Component header.%0a> %0a> If the name can be expanded to one or more classes that have component annotations (they must be inside the JAR), then each of those classes is analyzed for its component annotations. These annotations are then merged with the attributes from the header, where the header attributes override annotations. The expansion uses the normal wildcard rules. For example, @@biz.aQute.components.*@@ will search for component annotated classes in the  @@biz.aQute.components@@ package or one of its descendants. The classes must be present in the JAR. If no classes with annotations can be found for the @@name@@ then it is assumed to be name or implementation class name without annotations.%0a> %0a> The name of the component is also the implementation class (unless overridden by the implementation: directive). It is then followed with a number of references and directives. A reference defines a name that can be used with the @@locateService@@ method from the @@ComponentContext@@ class. If the name starts with a lower case character, it is assume to be a bean property. In that case the reference is augmented with a @@set%3cName>@@ and @@unset%3cName>@@ method according to the standard bean rules. Bnd will interpret the header, read the annotations if possible, and create the corresponding resources in the output jar under the name @@OSGI-INF/%3cid>.xml@@. %0a> %0a> The supported annotations in the @@aQute.bnd.annotations.component@@ package are:%0a> %0a> ||!Component||%0a> Annotated the class, indicates this class is required to be a component. It has the following properties:%0a> %0a> ||  provide||Class[]||Service interfaces, the default is all directly implemented interfaces||%0a> ||name     ||String||Name of the component||%0a> ||factory  ||Boolean||Factory component||%0a> ||servicefactory||Boolean||Service Factory||%0a> ||immediate||Boolean||Immediate activation||%0a> ||configurationPolicy||OPTIONAL, REQUIRE, IGNORE||Configuration Policy||%0a> ||enabled||Boolean||Enabled component||%0a> %0a> ||!Reference||%0a> On a method. Indicates this method is the activate method. It has the following attributes%0a> %0a> ||name||String||Name of the reference. Default this is the name of the method without set on it.||%0a> ||service||Class||The service type, default is the argument type of the method. The unset method is derived from this name. I.e. setXX will have an unsetXX method to unset the reference.||%0a> ||type||Character||Standard cardinality type '?', '*', '+','~'||%0a> %0a> ||!Activate, Modified, and Deactivate||%0a> The life cycle methods. These annotations have no properties.%0a> %0a>   %0a> Assume the JAR contains the following class"%0a> %0a>   package com.acme;%0a>   import org.osgi.service.event.*;%0a>   import org.osgi.service.log.*;%0a>   import aQute.bnd.annotation.component.*;%0a> %0a>   @Component%0a>   public class AnnotatedComponent implements EventHandler {%0a>     LogService log;%0a> %0a>     @Reference%0a>     void setLog(LogService log) { this.log=log; }%0a> %0a>     public void handleEvent(Event event) {%0a>       log.log(LogService.LOG_INFO, event.getTopic());%0a>     }%0a>   }%0a> %0a> The only thing necessary to register the Declarative Service component is to add the following Service-Component header:%0a> %0a>   Service-Component: com.acme.*%0a> %0a> This header will look for annotations in all com.acme sub-packages for an annotated component. The resulting XML will look like:%0a> %0a>   OSGI-INF/com.acme.AnnotatedComponent.xml:%0a>     %3c?xml version='1.0' encoding='utf-8'?>%0a>       %3ccomponent name='com.acme.AnnotatedComponent'>%0a>         %3cimplementation class='com.acme.AnnotatedComponent'/>%0a>         %3cservice>%0a>           %3cprovide interface='org.osgi.service.event.EventHandler'/>%0a>         %3c/service>%0a>         %3creference name='log'%0a>           interface='org.osgi.service.log.LogService' %0a>           bind='setLog'%0a>           unbind='unsetLog'/>%0a>       %3c/component>%0a> %0a> The following example shows a component that is bound to the log service via the setLog method without annotations:  %0a> %0a>   Service-Component=aQute.tutorial.component.World; [=\=]%0a>     log=org.osgi.service.log.LogService  %0a>    %0a> The Service Component Runtime (SCR) offers a variety of options on the reference. Some options like the target can be used by adding the target filter after the interface name (this likely requires putting quotes around the interface name+filter). %0a> %0a> References can be suffixed with the following characters to indicate their cardinality:%0a> %0a>   Char          Cardinality    Policy%0a>   ?             0..1           dynamic%0a>   *             0..n           dynamic%0a>   +             1..n           dynamic%0a>   ~             0..1           static%0a>                 1              static%0a> %0a> For a more complex example:%0a> %0a>   Service-Component=aQute.tutorial.component.World; [=\=]%0a>     log=org.osgi.service.log.LogService?; [=\=]%0a>     http=org.osgi.service.http.HttpService; [=\=]%0a>     PROCESSORS="xierpa.service.processor.Processor(priority>1)+"; [=\=]%0a>     properties:="wazaabi=true"%0a>     %0a> The previous example will result in the following service component in the resource @@OSGI-INF/aQute.tutorial.component.World.xml@@:  %0a> %0a>   %3c?xml version="1.0" encoding="utf-8" ?>%0a>    %3ccomponent name="aQute.tutorial.component.World">%0a>      %3cimplementation class="aQute.tutorial.component.World" /> %0a>      %3creference name="log" %0a>        interface="org.osgi.service.log.LogService" %0a>        cardinality="0..1" %0a>        bind="setLog" %0a>        unbind="unsetLog" %0a>        policy="dynamic" /> %0a>      %3creference name="http" %0a>        interface="org.osgi.service.http.HttpService" %0a>        bind="setHttp" %0a>        unbind="unsetHttp" />%0a>      %3creference name="PROCESSORS" %0a>        interface="xierpa.service.processor.Processor" %0a>        cardinality="1..n" %0a>        policy="dynamic" %0a>        target="(priority>1)" /> %0a>    %3c/component> %0a> %0a> The description also supports the immediate, enabled, factory, target, servicefactory, configuration-policy, activate, deactivate, and modified attributes. Refer to the Declarative Services definition for their semantics.%0a> %0a> If any feature of the V1.1 namespace is used, then bnd will declare the namespace in the @@component@@ element. A specific namespace version can be set with the @@version@@ directive.%0a> %0a> Bnd also supports setting the policy and cardinality through the following directives:%0a> %0a>   multiple:= LIST    names of references that have x..n%0a>   optional:= LIST    names of references that have 0..x%0a>   dynamic:=  LIST    names of references that are dynamic%0a> %0a> [[#macros]]%0a> !! Macros%0a> %0a> A simple macro processor is added to the header processing. Variables allow a single definition of a value, and the use of derivations. Each header is a macro that can be expanded. Notice that headers that do not start with an upper case character will not be copied to the manifest, so they can be used as working variables. Variables are expanded by enclosing the name of the variable in @@${%3cname>}@@ (curly braces) or @@$(%3cname>)@@ (parenthesis). Additionally, square brackets [], angled brackets %3c>, double guillemets , and single guillemets  are also allowed for brackets. If brackets are nested, that is $[replace;acaca;a(.*)a;[$1]] will return @@[cac]@@.%0a> %0a> For example:%0a> %0a>  version=1.23.87.200109111023542%0a>  Bundle-Version= ${version}%0a>  Bundle-Description= This bundle has version ${version}%0a> %0a> There are a number of built in properties that are set by bnd:%0a> %0a> ||%0a> ||!Property name ||!Description ||%0a> ||@@project@@||Name of the project. This is the name of the bnd file without the .bnd extension. If this name is bnd.bnd, then the directory name is used. ||%0a> ||@@project.file@@||Absolute path of the main bnd file. ||%0a> ||@@project.name@@||Just the name part of the file path ||%0a> ||@@project.dir@@||The absolute path of the directory in which the bnd file resides. ||%0a> %0a> There are also a number of macros that perform basic functions. All these functions have the following basic syntax:%0a> %0a>  macro ::= '${' function '}' %0a>          | '$[' function ']'%0a>          | '$(' function ')'%0a>          | '$%3c' function '>'%0a>          | '$' function ''%0a>          | '$' function ''%0a>  function ::= name ( ':' argument ) *%0a> %0a> ||%0a> ||!Function ||!Arguments ||!Description ||%0a> ||@@filter@@||; list ; regex ||The filter macro iterates over the given list and only includes elements that match the given regular expression (regex). The following example includes only the jar files from the list: \\%0a> @@list= a,b,c,d,x.jar,z.jar \\%0a> List= ${filter;${list};.*\\.jar}@@||%0a> ||@@filterout@@||; list ; regex ||The filterout macro iterates over the given list and removes elements that match the given regular expression (regex). The following example strips the jar files from the list:  \\%0a> @@list= a,b,c,d,x.jar,z.jar \\%0a> List= ${filterout:${list};.*\\.jar}@@||%0a> ||@@env@@||; name ||Provide the value of the given environment variable||%0a> ||@@sort@@||; list ||Sort the given list using string sorting collation. For example: \\%0a> @@List= ${sort:acme.jar, harry.jar, runner.jar, alpha.jar, bugs.jar}@@ ||%0a> ||@@classes@@||QUERY||Provides a query function to find classes to fullfil certain criteria. See the [[#classes|classes]] macro||%0a> ||@@join@@||( ; list ) * ||Joins a number of lists into one. It may seem that this can be easily accomplished by just placing two macro expansions after each other. The result of this will not be a list, unless a ',' (colon) is placed in between. However, when one of the lists is empty, the colon will be superfluous. The join handles these cases correctly. Any number of lists may be given as arguments. \\%0a> @@List= ${join;a,b,c;d,e,f}@@ ||%0a> ||@@if@@||; condition ; true ( ; false ) ? ||If the condition is not empty, the true part is returned, else the false part is returned. If not false part is supplied, the empty string is returned. The condition is trimmed before tested. For example: \\%0a> @@Comment: ${if;${version};Ok;Version is NOT set!!!!}@@||%0a> ||@@now@@||||Returns the current Date as string.  \\%0a> @@Created-When: ${now}@@||%0a> ||@@fmodified@@||; file-path-list ||Return the highest modification time of the given file path. The returned value is based on the epoch of Java, it is therefore a long.  \\%0a> @@Last-Modified: ${long2date;${fmodified;${files}})@@||%0a> ||@@long2date@@||; long ||Parse the long and turn it into a date.  \\%0a> @@Last-Modified: ${long2date:${fmodified:${files}})@@||%0a> ||@@replace@@||; list ; regex ; replacement ||Replace all elements of the list that match the regular expression regex with the replacement. The replacement can use the @@$[0-9]@@ back references defined in the regular expressions. The macro uses @@item.replaceAll(regex,replacement)@@ method to do the replacement.For example, to add a @@.jar@@ extension to all files listed, use the following: \\%0a> @@List = ${replace;${impls};$;.jar}@@||%0a> ||@@toclassname@@||; list||Replace a class path (with slashes and class at the end) to a class name (with dots).||%0a> ||@@toclasspath@@||; list  [ ; suffix ]||Replace a class name (with dots) to a classpath (with slashes and @@suffix@@ at the end). The default suffix is @@.class@@. The suffix may be empty||%0a> ||@@findname@@||; regex [ ; replacement ]  ||Find the paths to any resources that matches the regular expression, replace the name with the replacement of the regex. Notice that the regex is only executed on the name of the resource, that is, without the slashes.||%0a> ||@@findpath@@||; regex [ ; replacement ]  ||Find the paths to any resources that matches the regular expression, replace the path with the replacement of the regex. Notice that the regex is executed on the path of the resource, that is, with the slashes.||%0a> ||@@version@@||; mask ; version||This macro can modify a version by dropping parts from the end, incrementing parts, or decrementing parts. The mask is a string containing from 1 to 4 characters. The characters have the following meaning: \\%0a>   = the actual version part \\%0a>   + increment the actual version part \\%0a>   - decrement the actual version part \\%0a> For example, ${version;=+;1.2.3.q} will become 1.3.||%0a> %0a> [[#classes]]%0a> !!classes macro%0a> The classes macro provides a query function in an analyzed bundle. While analyzing, the Analyzer stores each found class on the Bundle-Classpath with some key information. A simple query language is used to query this dictionary. For example, if you want to make a manifest header with all public classes in the bundle:%0a> %0a>   Public-Classes: ${classes;PUBLIC}%0a> %0a> The query language is conjunctive, that is, all entries form an AND. For example, if you want to find all PUBLIC classes that are also not abstract you would do:%0a> %0a>   PublicConcrete-Classes: ${classes;CONCRETE}%0a> %0a> The query can also parameters. This is a pattern that must match some aspect of the class. For example, it is possible to query for classes that extend a certain base class:%0a> %0a>   Test-Cases: ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a> %0a> All pattern matching is based on fully qualified name and uses the globbing model.%0a> %0a> The following table specifies what query options there are:%0a> %0a> ||!Query         ||!Parameter   ||!Description||%0a> ||IMPLEMENTS     ||PATTERN      ||The class must implement at least one interface that matches the given pattern. This takes inheritance into account as long as intermediates can be found the classpath||%0a> ||EXTENDS        ||PATTERN      ||The class must implement at least one interface that matches the given pattern. This takes inheritance into account as long as intermediates can be found the classpath.||%0a> ||IMPORTS        ||PATTERN      ||The class must use a type from another package that matches the given pattern||%0a> ||NAMED          ||PATTERN      ||The class fqn must match the given pattern.||%0a> ||ANY            ||             ||Matches any class||%0a> ||VERSION        ||PATTERN      ||The class format of the given class must match the given version. The version is given as "%3cmajor>/%3cminor>", like "49/0". To select classes that are Java 6, do @@${classes;VERSION;49/*}@@||%0a> ||CONCRETE       ||             ||Class must not be abstract||%0a> ||ABSTRACT       ||             ||Class must be abstract||%0a> ||PUBLIC         ||             ||Class must be public||%0a> ||ANNOTATION     ||PATTERN      ||The class must have an annotation that matches the pattern. The set of annotations is all annotations in the class, also the annotations on fields and methods.||%0a> %0a> !!!Caveat%0a> bnd will attempt to use the resources on the classpath if a super class or interface that is referenced from an analyzed class is not in the class space. However, bnd does not require that all dependencies are available on the classpath. In such a case it is not possible to do a complete analysis. For example, if A extends B and B extends C then it can only be determined that A extends C if B can be analyzed.%0a>  %0a> !!Strategic%0a> %0a> [[#versionpolicy]]%0a> !!!Version Policy%0a> The version policy defines how an import is bound to a matched export when the import is not decorated with a version. Assuming that the exporter has a version, than it would be desirable to take that version, adapt it in a specific way to a range and use that as the import version. This is exactly what the @@-versionpolicy@@ allows. The value of this option is a string that will be used for the value of the import version. %0a> %0a> A hard coded string would not be very valuable, it is therefore possible to use the ${@} macro. This macro will contain the actual export version when the import version is calculated. This actual version can be processed by the @@${version}@@ macro to create a truncated or incremented version. This is best elucidated with some examples. In the following examples the export version is 1.2.3.q.%0a> %0a> ||!-versionpolicy                             ||!version||%0a> ||${@}                                        ||1.2.3.q||%0a> ||${version;==;${@}}                          ||1.2 (default)||%0a> ||[${version;==;${@}},${version;=+;${@}})      ||[1.2,1.3)||%0a> ||[${version;==;${@}},${version;+;${@}})       ||[1.2,2)||%0a> %0a> %0a> [[#cmd]]%0a> !! Command Line%0a> The command line tool can be invoked in several different ways:%0a> %0a> * bnd ''general-options'' ''cmd'' ''cmd-options''%0a> * bnd ''general-options'' ''%3cfile>.jar''%0a> * bnd ''general-options'' ''%3cfile>.bnd''%0a> %0a> !!! General Options%0a> %0a> ||%0a> ||!General Option ||!Description ||%0a> ||-failok ||Same as the property -failok. The current run will create a JAR file even if there were errors. ||%0a> ||-exceptions ||Will print the exception when the software has ran into a bad exception and bails out. Normally only a message is printed. For debugging or diagnostic reasons, the exception stack trace can be very helpful. ||%0a> %0a> !!! print ( -verify | -manifest | -list | - all ) * %3cfile>.jar +%0a> %0a> The print function will take a list of JAR file and print one or more aspect of the JAF riles. The following aspects can be added.%0a> %0a> * -verify - Verify the JAR for consistency with the specification. The print will exit with an error if the verify fails.%0a> * -manifest - Show the manifest%0a> * -list - List the entries in the JAR file%0a> * -all - Do all (this is the default.%0a> %0a>  bnd print -verify *.jar%0a> %0a> !!! build ( -classpath LIST | -eclipse %3cfile> | -noeclipse | -output %3cfile> ) * %3cfile>.bnd +%0a> %0a> The build function will assemble a bundle from the bnd specification. The default name of the output bundle is the name of the bnd file with a .jar extension.%0a> %0a> * -classpath - A list of JAR files and/or directories that should be placed on the class path before the calculation starts.%0a> * -eclipse - Parse the file as an Eclipse .classpath file, use the information to create an Eclipse's project class path. If this option is used, the default .classpath file is not read.%0a> * -noeclipse - Do not parse the .classpath file of an Eclipse project.%0a> * -output - Override the default output name of the bundle or the directory. If the output is a directory, the name will be derived from the bnd file name.%0a> %0a>  bnd build -classpath bin -noeclipse -output test.jar xyz.bnd%0a> %0a> %0a> [[#wrap]]%0a> !!! wrap ( -classpath (%3cfile>(','%3cfile>)*)-output %3cfile|dir> | -properties %3cfile> ) * \\%0a>   -ignoremanifest? %3cfile>.jar *%0a> %0a> The wrap command takes an existing JAR file and guesses the manifest headers that will make this JAR useful for an OSGi Service Platform. If the output file is not overridden, the name of the input file is used with a .bar extension. The default bnd file for the header calculation is:%0a> %0a>  Export-Package: * %0a>  Import-Package: %3cpackages inside the target jar>%0a> %0a> If the target bundle has a manifest, the headers are merged with the properties.%0a> %0a> The defaults can be overridden with a specific properties file.%0a> %0a> * -output - Set the output file or directory%0a> * -classpath - Sets the classpath as a comma separated list%0a> * -properties - Use a special property file for the manifest calculation.%0a> * -ignoremanifest - Do not include the manifest headers from the target bundle%0a> %0a>  bnd wrap -classpath osgi.jar *.jar%0a> %0a> !!! eclipse%0a> %0a> List the Eclipse information in the current directory.%0a> %0a>  bnd eclipse%0a> [[#eclipse]]%0a> !!Eclipse Plugin%0a> The bnd.jar file is a complete plugin. To install this plugin, place it in the eclipse/plugin directory (or extension directory) of your Eclipse installation and restart (!). The plugin will provides a 'Make Bundle' context menu when you select a file that ends with .bnd. Two menus are shown when you select a JAR file. You can 'Wrap JAR', turning it into a bundle with all imports and exports set (the extension will be .bar), or you can use 'Verify Bundle', and verify the bundle for compliance to the spec. Any errors or warnings are listed in a dialog box.%0a>  %0a> Additionally, the plugin registers an editor for JAR files. The editor shows the full output of the print command.%0a> %0a> [[#ant]]%0a> !! Ant Task%0a> The @@bnd.jar@@ file can also be used as an ANT task. The following example shows how you can use it from an ANT file.%0a> %0a>  %3ctarget name="build"> %0a>    %3ctaskdef resource="aQute/bnd/ant/taskdef.properties"%0a>       classpath="bnd.jar"/> %0a>    %3cbnd %0a>       classpath="src" %0a>       eclipse="true" %0a>       failok="false" %0a>       exceptions="true" %0a>       files="test.bnd"/> %0a>  %3c/target>%0a> %0a> You can set the following attributes:%0a> %0a> ||%0a> ||!Attribute ||!Description ||%0a> ||classpath ||Command separated list of file names. File paths are relative from the ant project file. ||%0a> ||eclipse ||True or false. True if the eclipse .classpath file should be read (default). ||%0a> ||failok ||Succeed even if there are errors. ||%0a> ||exceptions ||If errors occur, show the exception stack trace. ||%0a> ||files ||A comma separated list of bnd files ||%0a> ||sourcepath||A source path||%0a> ||output||Where the output should go||%0a> %0a> The following tasks have also been added:%0a> ||task name||Class||attributes||%0a> ||bndeclipse||EclipseTask||prefix='project.'||%0a> ||bndexpand||ExpandPropertiesTask||propertyFile='%3cfile>'||%0a> ||bndwrap||WrapTask||jars='%3clist>', output='%3cdir>', definitions='%3cdir>', classpath='%3cfile-list>'||%0a> %0a> [[#maven]]%0a> !!Maven%0a> The Maven plugin is described at [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html%0a> |Felix maven plugin]]. Defaults for Maven are:%0a> %0a>  Bundle-SymbolicName: %3cgroupId>.%3cartifactId>%0a>  Bundle-Name:         project.getName();%0a>  Bundle-Version:      %3cversion>%0a>  Import-Package:      *%0a>  Export-Package:      %3cgroupId>.%3cartifactId>.* (unless Private-package is set)%0a>  Bundle-Description:  project.getDescription()%0a>  Bundle-License:      project.getLicenses())%0a>  Bundle-Vendor:       project.getOrganization();%0a>  Include-Resource:    src/main/resources%0a> %0a> !! Errors and Warnings%0a> %0a> There are many errors and warnings. The messages should be self explanatory.%0a\ No newline at end of file%0a
host:1287241993=90.41.247.141
author:1287241958=
diff:1287241958:1287241934:=2,3d1%0a%3c http://www.aqute.biz/uploads/Code/bnd.png%0a%3c %0a4a3,5%0a> %0a> http://www.aqute.biz/uploads/Code/bnd.png%0a> %0a
host:1287241958=90.41.247.141
author:1287241934=
diff:1287241934:1287241934:=1,841d0%0a%3c (:title 01 Downloads::)%0a%3c !Downloads%0a%3c %0a%3c http://www.aqute.biz/uploads/Code/bnd.png%0a%3c %0a%3c * [[http://dl.dropbox.com/u/2590603/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.annotation.jar]] - Annotations and helper classes for bnd. These annotations are included in the lib and run version as well.%0a%3c * [[http://dl.dropbox.com/u/2590603/biz.aQute.bnd.annotation.jar|biz.aQute.bnd.jar]] - An eclipse plugin (though this functionality is taken over by [[http://github.com/njbartlett/bndtools|bndtools]], a command line utility (java -jar biz.aQute.bnd.jar), an ant task, and the library code. %0a%3c * [[http://dl.dropbox.com/u/2590603/biz.aQute.bndlib.jar|biz.aQute.bndlib.jar]] - A library so you can use bnd in your own projects.%0a%3c %0a%3c The source code is contained in the bundles.%0a%3c %0a%3c I strongly suggest to use [[http://github.com/njbartlett/bndtools|bndtools]] from Neil Bartlett because this puts a very pretty Eclipse GUI on top of bnd.%0a%3c %0a%3c ''How to pronounce and write bnd? bnd should be written with lower case characters because it is only modest tool. You pronounce it as be-and-de.''%0a%3c %0a%3c If you have questions about bnd then you can discuss these on the bndtools mailinglist: [[http://groups.google.com/group/bndtools-users|groups.google.com/group/bndtools-users]]. %0a%3c %0a%3c !!Articles about bnd%0a%3c * Introduction into bnd by Costin Leau, [[http://blog.springsource.com/main/2008/02/18/creating-osgi-bundles/|Creating OSGi bundles]]%0a%3c * [[http://www.aqute.biz/Blog/2007-05-21|Why you need bnd]]%0a%3c * [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html|Felix Maven Plugin based on bnd]]%0a%3c *  [[BndCn|Chinese version]]%0a%3c %0a%3c !! Introduction%0a%3c %0a%3c The bnd tool helps you create and diagnose OSGi R4 bundles. The key functions are:%0a%3c %0a%3c * Show the manifest and JAR contents of a bundle%0a%3c * Wrap a JAR so that it becomes a bundle%0a%3c * Create a Bundle from a specification and a class path%0a%3c * Verify the validity of the manifest entries%0a%3c %0a%3c The tool is capable of acting as:%0a%3c %0a%3c * [[#cmd|Command line tool]]%0a%3c * [[#eclipse|Eclipse Plugin]]%0a%3c * [[#maven|Maven Plugin]]%0a%3c * [[#ant|Ant Plugin]]%0a%3c %0a%3c Table Of Contents%0a%3c * [[#background|Background]]%0a%3c * [[#format|File format]]%0a%3c * [[#directives|Directives]]%0a%3c * [[#macros|Use of macros]]%0a%3c %0a%3c [[#background]]%0a%3c !!Background%0a%3c Traditionally, JAR files are made with the SUN jar tool, the jar ant task, or the Maven packager. All these tools share the same concept. The developer creates a directory image of the jar by copying files to a directory; this directory is then jarred. Obviously this method works well.%0a%3c %0a%3c The Bnd tool works different, it recognizes Java classes and packages and constructs the JAR from the classpath. It can create a JAR from packages the sources, directories or other JAR files. You never have to copy files around, the instructions that Bnd receives are sufficient to retrieve the files from their original location, preprocessing or filtering when required.%0a%3c %0a%3c The Jar is constructed from 3 different arguments:%0a%3c %0a%3c   Export-Package%0a%3c   Private-Package%0a%3c   Include-Resource%0a%3c %0a%3c Private-Package and Export-Package contain ''instructions''. Instructions are patterns + attributes and directives, looking like normal OSGi attributes and directives. For example:%0a%3c %0a%3c   Export-Package: com.acme.*;version=1.2%0a%3c %0a%3c Each instruction is applied to each package on the classpath in the definition order. That is, if an earlier instruction matches, the later instruction never gets a chance to do its work. If an instruction matches its attributes and properties are applied to the packages. The difference between the Private-Package argument and the Export-Package arguments is that the export version selects the packages for export. If the packages overlap between the two, the export wins.%0a%3c %0a%3c An instruction can also be negative when it starts with a '!'. In that case the package is excluded from the selection. For example:%0a%3c %0a%3c   Export-Package: !com.acme.impl, com.acme.*;version=1.2%0a%3c %0a%3c Note that the instructions are applied in order. If the ! instruction was at the end in the previous example, it would not have done its work because the com.acme.* would already have matched.%0a%3c %0a%3c The Include-Resource argument can be used to copy resources from the file system in the JAR. This is useful for licenses, images, etc. The instructions in the argument can be a directory, a file, or an inline JAR. The default JAR path is the the root for a directory or the filename for a file. The path can be overridden. Instructions that are enclosed in curly braces, like {license.txt}, are pre-processed, expanding any macros in the file.%0a%3c %0a%3c Once the JAR is created, the bnd program analyzes the classes and creates an import list with all the packages that are not contained in the jar but which are referred to. This import list is matched against the Import-Package instructions. Normally, the Import-Package argument is *; all referred packages will be imported. However, sometimes it is necessary to ignore an import or provide attributes on the import statement. For example, make the import optional or discard the import:%0a%3c %0a%3c   Import-Package: !com.acme.*, *;resolution:=optional%0a%3c %0a%3c The arguments to bnd are normal given as a set of properties. Properties that begin with an upper case are copied to the manifest (possibly after processing). Lower case properties are used for macro variables but are not set as headers in the manifest.%0a%3c %0a%3c After the JAR is created, the bnd program will verify the result. This will check the resulting manifest in painstaking detail.%0a%3c %0a%3c The bnd program works on a higher level then traditional jarring; this might take some getting used to. However, it is much more elegant to think in packages than that it is to think in files. The fact that Bnd understand the semantics of a bundle allows it to detect many errors and allows bundles to be created with almost no special information. %0a%3c %0a%3c Bnd will not create an output file if none of the resources is newer than an existing output file.%0a%3c %0a%3c The program is available in several forms: command line, ant task, maven plugin, and an Eclipse plugin.%0a%3c %0a%3c [[#quick]]%0a%3c !!Quick Start%0a%3c %0a%3c Assume we need to create a bundle in Eclipse. Each Java project in Eclipse has a set of sources and a class path. Bnd therefore knows, about all the classes. However, it does not know how you want to structure your JARs/Bundles. It therefore needs a description file, the ''bnd file''. If you create such a file, you should give it the same as name as the bundle symbolic name with a @@.bnd@@ extension. For example @@aQute.example.bnd@@ is a well chosen name. If the name is not @@bnd.bnd@@, the file name without the .bnd extension is the default for your bundle symbolic name.%0a%3c %0a%3c Lets build a bundle for the aQute OSGi tutorial Chat example. This bundle has 2 packages.%0a%3c %0a%3c * aQute.service.channel%0a%3c * aQute.tutorial.chat%0a%3c %0a%3c The @@aQute.service.channel@@ package must be exported and the other package may remain private. All packages that are referred from the source code must be imported. To achieve this, the following manifest will suffice:%0a%3c %0a%3c   Export-Package: aQute.service.channel; version=1.0 %0a%3c   Private-Package: aQute.tutorial.chat%0a%3c %0a%3c This is all you need! In Eclipse, you can select the bnd file and run the @@Make Bundle@@ command. This will create a JAR with the proper content:%0a%3c %0a%3c  META-INF %0a%3c    MANIFEST.MF %0a%3c  aQute/service/channel %0a%3c    Channel.class %0a%3c    aQute/tutorial/chat %0a%3c    Chat$ChannelTracker.class %0a%3c    Chat.class%0a%3c %0a%3c You can run the same command from the command line%0a%3c %0a%3c  bnd aQute.tutorial.chat.bnd%0a%3c %0a%3c Now take a look at the JAR file's manifest. With the command line version of you can do this with @@bnd aQute.tutorial.chat.jar@@. Otherwise just open the JAR with WinZip.%0a%3c %0a%3c  Manifest-Version: 1%0a%3c  Bundle-Name: aQute.tutorial.chat%0a%3c  Private-Package: aQute.tutorial.chat%0a%3c  Import-Package: aQute.service.channel;version=1.0,%0a%3c    org.osgi.framework; version=1.3,%0a%3c    org.osgi.util.tracker;version=1.3%0a%3c  Bundle-ManifestVersion: 2%0a%3c  Bundle-SymbolicName: aQute.tutorial.chat%0a%3c  Export-Package: aQute.service.channel;version=1.0%0a%3c  Bundle-Version: 0%0a%3c %0a%3c As you can see, bnd filled in a number of headers. The first header, Manifest-Version is required by the JAR standard. Bundle-Name is derived from the Bundle-SymbolicName because we did not specify it. The Private-Package header specifies the packages that ended up not exported. The Import-Package header comes from the packages that were referred to from the contained packages (private and exported). As you can see, bnd picked up versions for the imported packages. These versions come from the manifest of the JARs that source these packages, or from the packageinfo file. The Export-Package shows the export of the service package. On top of this, bnd has verified that all your headers really match the OSGi specifications, or you will get errors and warnings.%0a%3c %0a%3c [[#format]]%0a%3c !!Bnd file format%0a%3c %0a%3c The bnd format is very similar to the manifest. Though it is read with the Properties class, you can actually use the ':' as separator to make it look more like a manifest file. The only thing you should be aware of is that the line continuation method of the Manifest (a space as the first character on the line) is not supported. Line continuations are indicated with the backslash ('\' \u005C) as the last character of the line. Lines may have any length. You can add comments with a # on the first character of the line:%0a%3c %0a%3c   # This is a comment%0a%3c %0a%3c White spaces around the key and value are trimmed. See [[http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html |  Properties]] for more information about the format.%0a%3c %0a%3c There are different instructions in the properties file:%0a%3c %0a%3c ||%0a%3c ||!Type ||!Example ||!Description ||%0a%3c ||Manifest headers ||Bundle-Description: ... ||When the first character is a upper case character. These headers are copied to the manifest or augmented by bnd. ||%0a%3c ||Variables ||version=3.0 ||Variables are lower case headers. Headers can contain references to other headers using macro expansion. Variables are not copied to the manifest. See [[#macros|Macros]] ||%0a%3c ||Directives ||-include: deflts.bnd ||Directives start with a '-' sign. A directive is an instruction to bnd to do something special. See [[#directives|Directives]] ||%0a%3c %0a%3c [[#directives]]%0a%3c !! Bnd Directives%0a%3c %0a%3c ||%0a%3c ||!Instruction ||!Format ||!Description ||%0a%3c ||@@-classpath@@||[[#list | LIST]] ||Add the listed files to the current class path. The files must be addressed relative to the properties file. The files must be either a JAR file or a directory. For example:\\%0a%3c @@-classpath= acme.jar, junit.jar, bin@@ ||%0a%3c ||@@-debug@@||@@true|false@@||Generate debugging information. This will save embedded jar files in the target directory when they are generated on the fly.||%0a%3c ||@@-donotcopy@@||[[#regex | REGEX]] ||During copying of files from the classpath, file system, or other places, this filter is used to prevent copies. For example, normally @@CVS@@ and @@.svn@@ directories should not be copied. The default is therefore @@(CVS|.svn)@@. Example:  \\%0a%3c @@-donotcopy= (CVS|.svn|.+.bak|~.+)@@ ||%0a%3c ||-include ||[[#list | LIST]] ||This property will include the list of files in the given order. The files are relative from the bnd file itself. If this directive is used inside an included properties file, then the including file is the base. Includes are very useful to keep headers like Bundle-Vendor, Bundle-Copyright central. If the extension of the file is .mf, then the file is parsed as a manifest file. By default, a property defined in an include file override earlier definitions, this implies that any property in the bnd file is overridden if defined in an include file. The include files are read in the order they are listed where later files override earlier files. If there are multiple definitions for the same property, then the last definitions wins. If the path of an included file starts with a ~, then it will '''not''' override earlier set properties.\\%0a%3c You can use properties like ${user.home} in file names. If the file does not exist, an error is generated. If the filename is prefixed with a '-' sign then no error is generated when the file is absent. For example:  \\%0a%3c \\%0a%3c @@-include= ~${user.home}/deflts.bnd, META-INF/MANIFEST.MF@@\\%0a%3c @@-include= a.props, ~META-INF/MANIFEST.MF@@ ||%0a%3c ||@@-nope@@||true|false||Do not build a bundle||%0a%3c ||@@-exportcontents@@||[[#LIST|LIST]] of [[#PATTERN | PATTERN]]||The content of this header augments the Export-Package header, but only for the manifest calculation. That is, Export-Package is used to calculate the contents of the JAR, but then this instruction can be used change or add instructions for the manifest generation.||%0a%3c ||-failok ||true | false ||In certain cases, errors should not abort the creation of the bundle. For example test cases often require the creation of an invalid JAR. If this flag is set to true, errors will create a target bundle (when possible) and errors are only listed. When failok is false, the default, any error will not create a target bundle and will delete the bundle file. Example:  \\%0a%3c @@-failok= true@@ ||%0a%3c ||@@-manifest@@||FILE||Overrides the generation of a manifest and uses the given file instead.||%0a%3c ||@@-nomanifest@@||false|true||Generate a JAR without a manifest||%0a%3c ||@@-output@@||PATH||Store the file (if applicable) under the path||%0a%3c ||@@-removeheaders@@||[[#LIST|LIST]] of string||Removes the given headers from the output manifest. This feature can be useful if you are wrapping a bundle and it contains for example a Require-Bundle header.||%0a%3c ||@@-nouses@@||@@true|false@@||Do not calculate the @@uses:@@ directive.||%0a%3c ||@@-plugin@@||[[#LIST|LIST]] of [[#PLUGIN|PLUGIN]]||Define the plugins that bnd should use. A plugin is a class that is used at certain phases in the bundle generation. That place is defined by the interfaces it implements. Plugins are defined in [[#plugins|plugins]].||%0a%3c ||@@-sources@@||@@true|false@@||Include sources||%0a%3c ||@@Export-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Export-Package header lists the packages that the bundle should export, and thus contain. [[#export-package|See ExportPackage]].||%0a%3c ||@@Include-Resource@@||[[#LIST|LIST]] of iclause||The Include-Resource instruction makes it possible to include arbitrary resources; it contains a list of resource paths. [[#include-resource|See Include Resource]].||%0a%3c ||@@Private-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Private-Package header lists the packages that the bundle should contain but not export. [[#private-package|See Private Package]].||%0a%3c ||@@Import-Package@@||[[#LIST | LIST]] of [[#PATTERN | PATTERN]] ||The Import-Package header lists the packages that are required by the contained packages. [[#import-package|See Import Package]].||%0a%3c ||@@Conditional-Package@@||[[#LIST|LIST]] of [[#PATTERN|PATTERN]] || '''experimental''' Works as private package but will only include the packages when they are imported. When this header is used, bnd will recursively add packages that match the patterns until there are no more additions.||%0a%3c ||@@Bundle-\\%0a%3c SymbolicName@@|| ||The Bundle-SymbolicName header can be set by the user. The default is the name of the main bnd file, or if the main bnd file is called bnd.bnd, it will be the name of the directory of the bnd file. An interesting variable is ${project} that will be set to this default name. ||%0a%3c ||@@Bundle-Name@@|| ||If the Bundle-Name is not set, it will default to the Bundle-SymbolicName. ||%0a%3c ||@@Bundle-\\%0a%3c ManifestVersion@@||2 ||The Bundle-ManifestVersion is always set to 2, there is no way to override this. ||%0a%3c ||@@Bundle-Version@@||VERSION ||The version of the bundle. If no such header is provided, a version of 0 will be set. ||%0a%3c ||@@Service-Component@@||[[#LIST | LIST]] of @@component@@ || See [[#component|Service Component Header]].||%0a%3c %0a%3c %0a%3c !!Basic Types%0a%3c ||[[#list]][[#LIST]]LIST||A comma separated list. Items should be quoted with '"' if the contain commas. In general, a list item can also define attributes and directives on an item.||%0a%3c ||[[#pattern]][[#PATTERN]]PATTERN||A pattern matches some entity: a package, a directory, etc. Patterns are based on Java regular expressions but are preprocessed before compiled. Any dots ('.') are replaced with \. to make them match the input and not act as the 'any character' operator. Any '?' or '*' is prefixed with a dot to make it match any character. As an extra convenience, if the string ends with \..*, an additional pattern is added to match the complete string with out the \..*. The effect is that something like com.acme.* matches com.acme and all its sub packages. It is also to negate a pattern by prefixing it with an exclamation mark ('!'). For example:\\%0a%3c    @@Import-Package: !com.sun.*, *@@ \\%0a%3c indicates that any imports to com.sun should not be imported.||%0a%3c ||[[#regex]]REGEX||A regular expressions||%0a%3c %0a%3c %0a%3c [[#export-package]]%0a%3c !!Export-Package%0a%3c The bnd definition allows the specification to be done using ''patterns'', a modified regular expression. All patterns in the definition are matched against every package on the [[#CLASSPATH | class path]]. If the pattern is a negating pattern (starts with !) and it is matched, then the package is completely excluded. Normal patterns cause the package to be included in the resulting bundle. Patterns can include both directives and attributes, these items will be copied to the output. The list is ordered, earlier patterns take effect before later patterns. The following examples copies everything on the class path except for packages starting with @@com@@. The default for Export-Package is "*", which can result in quite large bundles. If the source packages have an associated version (from their manifest of packageinfo file), then this version is automatically added to the clauses.%0a%3c %0a%3c   Export-Package= !com.*, *%0a%3c %0a%3c Exports are automatically imported. This features can be disabled with a special directive on the export instruction: @@-noimport:=true@@. For example:%0a%3c   %0a%3c   Export-Package= com.acme.impl.*;-noimport:=true, *%0a%3c %0a%3c Bnd will automatically calculate the @@uses:@@ directive. This directive is used by the OSGi framework to create a consistent class space for a bundle. The Export-Package statement allows this directive to be overridden on a package basis by specifying the directive in an Export-Package instruction. %0a%3c %0a%3c   Export-package = com.acme.impl.*;uses="my.special.import"%0a%3c %0a%3c However, in certain cases it is necessary to augment the uses clause. It is therefore possible to use the special name @@%3c%3cUSES>>@@ in the clause. Bnd will replace this special name with the calculated uses set. Bnd will remove any extraneous commas when the @@%3c%3cUSES>>@@ is empty.%0a%3c %0a%3c   Export-package = com.acme.impl.*;uses="my.special.import,%3c%3cUSES>>"%0a%3c %0a%3c !!!Split packages%0a%3c Bnd traverse the packages on the classpath and copies them to the output based on the instructions given by the Export-Package and Private-Package headers. This opens up for the possibility that there are multiple packages with the same name on the class path. It is better to avoid this situation because it means there is no cohesive definition of the package and it is just, eh, messy. However, there are valid cases that packages should be merged from different sources. For example, when a standard package needs to be merged with implementation code like the osgi packages sometimes (unfortunately) do. Without any extra instructions, bnd will merge multiple packages where the last one wins if the packages contain duplicate resources, but it will give a warning to notify the unwanted case of split packages.%0a%3c %0a%3c The @@-split-package:@@ directive on the Export-Package/Private-Package clause allows fine grained control over what should be done with split packages. The following values are architected:%0a%3c %0a%3c ||@@merge-first@@||Merge split packages but do not add resources that come later in the classpath. That is, the first resource wins. This is the default, although the default will generate a warning||%0a%3c ||@@merge-last@@||Merge split packages but overwrite resources that come earlier in the classpath. That is, the last resource wins.||%0a%3c ||@@first@@||Do not merge, only use the first package found||%0a%3c ||@@error@@||Generate an error when a split package is detected||%0a%3c %0a%3c For example:%0a%3c %0a%3c   Private-Package: test.pack;-split-package:=merge-first%0a%3c %0a%3c %0a%3c %0a%3c %0a%3c [[#private-package]]%0a%3c !!Private Package%0a%3c The method of inclusion is identical to the Export-Package header, the only difference is, is that these packages are not exported. This header will be copied to the manifest. If a package is selected by noth the export and private package headers, then the export takes precedence.%0a%3c %0a%3c   Private-Package= com.*%0a%3c %0a%3c [[#import-package]]%0a%3c !!Import Package%0a%3c The Import-Package header lists the packages that are required by the contained packages. The default for this header is "*", resulting in importing all referred packages. This header therefore rarely has to be specified. However, in certain cases there is an unwanted import. The import is caused by code that the author knows can never be reached. This import can be removed by using a negating pattern. A pattern is inserted in the import as an extra import when it contains no wildcards and there is no referral to that package. This can be used to add an import statement for a package that is not referred to by your code but is still needed, for example, because the class is loaded by name.%0a%3c %0a%3c For example:%0a%3c   Import-Package: !org.apache.commons.log4j, com.acme.*,%0a%3c      com.foo.extra%0a%3c %0a%3c During processing, bnd will attempt to find the exported version of imported packages. If no version or version range is specified on the import instruction, the exported version will then be used though the micro part and the qualifier are dropped. That is, when the exporter is @@1.2.3.build123@@, then the import version will be 1.2. If a specific version (range) is specified, this will override any found version. This default an be overridden with the [[#versionpolicy|-versionpolicy]] command.%0a%3c %0a%3c If an explicit version is given, then ${@} can be used to substitute the found version in a range. In those cases, the version macro can be very useful to calculate ranges or drop specific parts of the version. For example:%0a%3c %0a%3c   Import-Package: org.osgi.framework;version="[1.3,2.0)"%0a%3c   Import-Package: org.osgi.framework;version=${@}%0a%3c   Import-Package: org.osgi.framework;version="[${version;==;${@}},${version;=+;${@}})"%0a%3c %0a%3c If an imported package uses mandatory attributes, then bnd will attempt to add those attributes to the import statement. However, in certain (bizarre!) cases this is not wanted. It is therefore possible to remove an attribute from the import clause. This is done with the @@-remove-attribute:@@ directive or by setting the value of an attribute to !. The parameter of the @@-remove-attribute@@ directive is an instruction and can use the standard options with !, *, ?, etc.%0a%3c %0a%3c   Import-Package: org.eclipse.core.runtime;-remove-attribute:common,*%0a%3c %0a%3c Or%0a%3c %0a%3c   Import-Package: org.eclipse.core.runtime;common=!,*%0a%3c %0a%3c %0a%3c [[#include-resource]]%0a%3c !!Include Resource%0a%3c The resources will be copied into the target jar file. The iclause can have the following forms:%0a%3c %0a%3c   iclause    ::= inline | copy%0a%3c   copy       ::= '{' process '}' | process%0a%3c   process    ::= assignment | simple%0a%3c   assignment ::= PATH '=' simple%0a%3c   simple     ::= PATH parameter*%0a%3c   inline     ::= '@' PATH ( '!/' PATH? ('/**' | '/*')? )?%0a%3c   parameters ::= 'flatten' | 'recursive' | 'filter'%0a%3c %0a%3c In the case of @@assignment@@ or @@simple@@, the PATH parameter can point to a file or directory. It is also possible to use the name.ext path of a JAR file on the classpath, that is, ignoring the directory. The @@simple@@ form will place the resource in the target JAR with only the file name, therefore without any path components. That is, including src/a/b.c will result in a resource b.c in the root of the target JAR. %0a%3c %0a%3c If the PATH points to a directory, the directory name itself is not used in the target JAR path. If the resource must be placed in a subdirectory of the target jar, use the @@assignment@@ form. If the file is not found, bnd will traverse the classpath to see of any entry on the classpath matches the given file name (without the directory) and use that when it matches. The @@inline@@ requires a ZIP or JAR file, which will be completely expanded in the target JAR (except the manifest), unless followed with a file specification. The file specification can be a specific file in the jar or a directory followed by ** or *. The ** indicates recursively and the * indicates one level. If just a directory name is given, it will mean **.%0a%3c %0a%3c The @@simple@@ and @@assigment@@ forms can be encoded with curly braces, like @@{foo.txt}@@. This indicates that the file should be preprocessed (or filtered as it is sometimes called). Preprocessed files can use the same variables and macros as defined in the [[#macros|macro section]].%0a%3c %0a%3c The @@recursive:@@ directive indicates that directories must be recursively included.%0a%3c %0a%3c The @@flatten:@@ directive indicates that if the directories are recursively searched, the output must not create any directories. That is all resources are flattened in the output directory.%0a%3c %0a%3c The @@filter:@@ directive is an optional filter on the resources. This uses the same format as the instructions. Only the file name is verified against this instruction.%0a%3c %0a%3c  Include-Resource: @osgi.jar,%0a%3c     {LICENSE.txt},%0a%3c     acme/Merge.class=src/acme/Merge.class%0a%3c %0a%3c %0a%3c %0a%3c [[#plugins]]%0a%3c !!!Plugins%0a%3c Plugins are objects that can extend the functionality of bnd. They are called from inside bnd when a certain action should take place. For example, bnd uses a repository and plugins provide the actual repository implementations. Or for example, the SpringComponent analyzes the Spring files and adds references found in that XML to the imports.%0a%3c %0a%3c A plugin is defined as:%0a%3c %0a%3c   PLUGIN ::= FQN ( ';' %3cdirective|attribute> )*%0a%3c %0a%3c The following directive is defined for all plugin:%0a%3c %0a%3c ||@@path:@@ ||A path to the jar file that contains the plugin||%0a%3c %0a%3c bnd current supports the following plugin types:%0a%3c %0a%3c   /**%0a%3c    * An optional interface for plugins. If a plugin implements %0a%3c    * this interface then it can receive the remaining attributes %0a%3c    * and directives given in its clause as%0a%3c    * well as the reporter to use.%0a%3c    */%0a%3c   public interface Plugin {%0a%3c     /**%0a%3c      * Give the plugin the remaining properties.%0a%3c      * When a plugin is declared, the clause can contain %0a%3c      * extra properties. All the properties and directives %0a%3c      * are given to the plugin to use.%0a%3c      * @param map attributes and directives for this plugin's clause%0a%3c      */%0a%3c     void setProperties(Map%3cString,String> map);%0a%3c     %0a%3c     /**%0a%3c      * Set the current reporter. This is called at init time. %0a%3c      * This plugin should report all errors and warnings %0a%3c      * to this reporter.%0a%3c      * @param processor%0a%3c      */%0a%3c     void setReporter(Reporter processor);%0a%3c  }%0a%3c %0a%3c   public interface AnalyzerPlugin {%0a%3c     /**%0a%3c      * This plugin is called after analysis. The plugin %0a%3c      * is free to modify the jar and/or change the classpath %0a%3c      * information (see referred, contained).%0a%3c      * This plugin is called after analysis of the JAR %0a%3c      * but before manifest generation.%0a%3c      * %0a%3c      * @param analyzer%0a%3c      * @return true if the classpace has been modified so that the bundle%0a%3c      *         classpath must be reanalyzed%0a%3c      * @throws Exception%0a%3c      */%0a%3c     boolean analyzeJar(Analyzer analyzer) throws Exception;%0a%3c   }%0a%3c %0a%3c   public interface SignerPlugin {%0a%3c     /**%0a%3c      * Sign the current jar. The alias is the given certificate %0a%3c      * keystore.%0a%3c      * %0a%3c      * @param builder   The current builder that contains the %0a%3c                         jar to sign%0a%3c      * @param alias     The keystore certificate alias%0a%3c      * @throws Exception When anything goes wrong%0a%3c      */%0a%3c     void sign(Builder builder, String alias) throws Exception;%0a%3c   }%0a%3c %0a%3c   public interface RepositoryPlugin {%0a%3c     /**%0a%3c      * Return a URL to a matching version of the given bundle.%0a%3c      * %0a%3c      * @param bsn%0a%3c      *            Bundle-SymbolicName of the searched bundle%0a%3c      * @param range%0a%3c      *            Version range for this bundle,"latest" %0a%3c      *            if you only want the%0a%3c      *            latest, or null when you want all.%0a%3c      * @return    A list of URLs sorted on version, lowest version %0a%3c      *            is at index 0.%0a%3c      *            null is returned when no files with the given %0a%3c      *            bsn ould be found.%0a%3c      * @throws Exception%0a%3c      *             when anything goes wrong%0a%3c      */%0a%3c     File[] get(String bsn, String range) throws Exception;%0a%3c     %0a%3c     /**%0a%3c      * Answer if this repository can be used to store files.%0a%3c      * %0a%3c      * @return true if writable%0a%3c      */%0a%3c     boolean canWrite();%0a%3c     %0a%3c     /**%0a%3c      * Put a JAR file in the repository.%0a%3c      * %0a%3c      * @param jar%0a%3c      * @throws Exception%0a%3c      */%0a%3c     File  put(Jar jar) throws Exception;%0a%3c     %0a%3c     /**%0a%3c      * Return a list of bsns that are present in the repository.%0a%3c      * %0a%3c      * @param  regex if not null, match against the bsn and if %0a%3c      *         matches, return otherwise skip%0a%3c      * @return A list of bsns that match the regex parameter %0a%3c      *         or all if regex is null%0a%3c      */%0a%3c     List%3cString> list(String regex);%0a%3c     %0a%3c     /**%0a%3c      * Return a list of versions.%0a%3c      */%0a%3c     %0a%3c     List%3cVersion> versions(String bsn);%0a%3c   }%0a%3c %0a%3c   public interface MakePlugin {%0a%3c %0a%3c     /**%0a%3c      * This plugin is called when Include-Resource detects %0a%3c      * a reference to a resource that it can not find in the %0a%3c      * file system.%0a%3c      * %0a%3c      * @param builder   The current builder%0a%3c      * @param source    The source string (i.e. the place %0a%3c      *                  where bnd looked)%0a%3c      * @param arguments Any arguments on the clause in %0a%3c      *                  Include-Resource%0a%3c      * @return          A resource or null if no resource %0a%3c      *                  could be made%0a%3c      * @throws Exception%0a%3c      */%0a%3c     Resource make(Builder builder, String source, %0a%3c           Map%3cString,String> arguments) throws Exception;%0a%3c   }%0a%3c %0a%3c [[#make]]%0a%3c !!!Make%0a%3c Make plugins kick in when the @@Include-Resource@@ header tries to locate a resource but it cannot find that resource. The @@-make@@ option defines a number of patterns that are mapped to a make instruction.%0a%3c %0a%3c For example, if you have%0a%3c %0a%3c   Include-Resource:       com.acme.Abc.ann%0a%3c %0a%3c If no such resource is found, bnd will look in the -make instruction. This instruction associates a pattern with a plugin type. For example:%0a%3c %0a%3c        -make:                  (*.jar); type=xyz; abc=3; def="$1"%0a%3c %0a%3c The first name part of the clause is matched against the unfound resource. All plugins are called sequentially until one returns non-null. The arguments on the -make clause are given as parameters to the make plugin. Normally all Make Plugins should verify the type field.%0a%3c %0a%3c bnd has a bnd and a copy Make Plugin.%0a%3c %0a%3c !!!Buildin Plugins%0a%3c Some plugins are provided by bnd itself.%0a%3c %0a%3c ||aQute.lib.spring.SpringComponent||AnalyzerPlugin||This component will analyze the Spring XML for Spring DM and will add any classes in these files to the referred set of classes.||%0a%3c ||aQute.bnd.make.MakeBnd||MakePlugin||If Include-Resource can't find a referred resource it will use the make plugins to see if any of them can make the requested resource. The MakeBnd has type=bnd. This plugin can recursively call bnd to create embedded jars that are not created sequentially||%0a%3c ||aQute.bnd.make.MakeCopy||MakePlugin||Copies resources from other places in the file system||%0a%3c ||aQute.lib.deployer.FileRepo||RepositoryPlugin||Provides a file based repository.||%0a%3c ||aQute.bnd.maven.MavenRepository||RepositoryPlugin||Provides an interface to a the default maven repository in the user's home directory. Can be used with aQute.bnd.maven.MavenGroup to support converting bundle symbolic names to group and artifact id.||%0a%3c %0a%3c [[#component]]%0a%3c !!!Service-Component Header%0a%3c The Service-Component header is compatible with the standard OSGi header syntax. Any element in the list that does not have attributes must have a resource in the JAR and is copied as is to the manifest. However, simple components can also be defined inline, and it is even possible to pickup annotations. %0a%3c %0a%3c The syntax for these component definitions is:%0a%3c %0a%3c   component ::= %3cname> ( ';' parameter ) * %0a%3c   parameter ::= provide | reference | multiple | optional%0a%3c               | reference | properties | factory | servicefactory%0a%3c               | immediate | enabled | implementation %0a%3c               | activate | deactivate | modified | configuration-policy%0a%3c               | version%0a%3c   reference ::= %3cname> '=' %3cinterface-class> %0a%3c                  ( '(' %3ctarget-filter> ')')? cardinality?%0a%3c   cardinality ::= '?' | '*' | '+' | '~'%0a%3c   provide  ::= 'provide:=' LIST %0a%3c   multiple  ::= 'multiple:=' LIST %0a%3c   optional  ::= 'optional:=' LIST %0a%3c   dynamic   ::= 'dynamic:=' LIST%0a%3c   factory   ::= 'factory:=' true | false%0a%3c   servicefactory := 'servicefactory:=' true | false%0a%3c   immediate ::= 'immediate:=' true | false%0a%3c   enabled   ::= 'enabled:=' true | false%0a%3c   configuration-policy ::= "configuration-policy:=' ( 'optional' | 'require' | 'ignore' )%0a%3c   activate  ::= 'activate:=' METHOD%0a%3c   modified  ::= 'activate:=' METHOD%0a%3c   deactivate::= 'activate:=' METHOD%0a%3c   implementation::= 'implementation:=' %3cimplementation-class>%0a%3c   properties::= 'properties:=' key '=' value  [=\=]%0a%3c                 ( ',' key '=' value ) *%0a%3c %0a%3c If the name of the component maps to a resource, or ends in XML, or there are attributes set, then that clause is copied to the output Service-Component header.%0a%3c %0a%3c If the name can be expanded to one or more classes that have component annotations (they must be inside the JAR), then each of those classes is analyzed for its component annotations. These annotations are then merged with the attributes from the header, where the header attributes override annotations. The expansion uses the normal wildcard rules. For example, @@biz.aQute.components.*@@ will search for component annotated classes in the  @@biz.aQute.components@@ package or one of its descendants. The classes must be present in the JAR. If no classes with annotations can be found for the @@name@@ then it is assumed to be name or implementation class name without annotations.%0a%3c %0a%3c The name of the component is also the implementation class (unless overridden by the implementation: directive). It is then followed with a number of references and directives. A reference defines a name that can be used with the @@locateService@@ method from the @@ComponentContext@@ class. If the name starts with a lower case character, it is assume to be a bean property. In that case the reference is augmented with a @@set%3cName>@@ and @@unset%3cName>@@ method according to the standard bean rules. Bnd will interpret the header, read the annotations if possible, and create the corresponding resources in the output jar under the name @@OSGI-INF/%3cid>.xml@@. %0a%3c %0a%3c The supported annotations in the @@aQute.bnd.annotations.component@@ package are:%0a%3c %0a%3c ||!Component||%0a%3c Annotated the class, indicates this class is required to be a component. It has the following properties:%0a%3c %0a%3c ||  provide||Class[]||Service interfaces, the default is all directly implemented interfaces||%0a%3c ||name     ||String||Name of the component||%0a%3c ||factory  ||Boolean||Factory component||%0a%3c ||servicefactory||Boolean||Service Factory||%0a%3c ||immediate||Boolean||Immediate activation||%0a%3c ||configurationPolicy||OPTIONAL, REQUIRE, IGNORE||Configuration Policy||%0a%3c ||enabled||Boolean||Enabled component||%0a%3c %0a%3c ||!Reference||%0a%3c On a method. Indicates this method is the activate method. It has the following attributes%0a%3c %0a%3c ||name||String||Name of the reference. Default this is the name of the method without set on it.||%0a%3c ||service||Class||The service type, default is the argument type of the method. The unset method is derived from this name. I.e. setXX will have an unsetXX method to unset the reference.||%0a%3c ||type||Character||Standard cardinality type '?', '*', '+','~'||%0a%3c %0a%3c ||!Activate, Modified, and Deactivate||%0a%3c The life cycle methods. These annotations have no properties.%0a%3c %0a%3c   %0a%3c Assume the JAR contains the following class"%0a%3c %0a%3c   package com.acme;%0a%3c   import org.osgi.service.event.*;%0a%3c   import org.osgi.service.log.*;%0a%3c   import aQute.bnd.annotation.component.*;%0a%3c %0a%3c   @Component%0a%3c   public class AnnotatedComponent implements EventHandler {%0a%3c     LogService log;%0a%3c %0a%3c     @Reference%0a%3c     void setLog(LogService log) { this.log=log; }%0a%3c %0a%3c     public void handleEvent(Event event) {%0a%3c       log.log(LogService.LOG_INFO, event.getTopic());%0a%3c     }%0a%3c   }%0a%3c %0a%3c The only thing necessary to register the Declarative Service component is to add the following Service-Component header:%0a%3c %0a%3c   Service-Component: com.acme.*%0a%3c %0a%3c This header will look for annotations in all com.acme sub-packages for an annotated component. The resulting XML will look like:%0a%3c %0a%3c   OSGI-INF/com.acme.AnnotatedComponent.xml:%0a%3c     %3c?xml version='1.0' encoding='utf-8'?>%0a%3c       %3ccomponent name='com.acme.AnnotatedComponent'>%0a%3c         %3cimplementation class='com.acme.AnnotatedComponent'/>%0a%3c         %3cservice>%0a%3c           %3cprovide interface='org.osgi.service.event.EventHandler'/>%0a%3c         %3c/service>%0a%3c         %3creference name='log'%0a%3c           interface='org.osgi.service.log.LogService' %0a%3c           bind='setLog'%0a%3c           unbind='unsetLog'/>%0a%3c       %3c/component>%0a%3c %0a%3c The following example shows a component that is bound to the log service via the setLog method without annotations:  %0a%3c %0a%3c   Service-Component=aQute.tutorial.component.World; [=\=]%0a%3c     log=org.osgi.service.log.LogService  %0a%3c    %0a%3c The Service Component Runtime (SCR) offers a variety of options on the reference. Some options like the target can be used by adding the target filter after the interface name (this likely requires putting quotes around the interface name+filter). %0a%3c %0a%3c References can be suffixed with the following characters to indicate their cardinality:%0a%3c %0a%3c   Char          Cardinality    Policy%0a%3c   ?             0..1           dynamic%0a%3c   *             0..n           dynamic%0a%3c   +             1..n           dynamic%0a%3c   ~             0..1           static%0a%3c                 1              static%0a%3c %0a%3c For a more complex example:%0a%3c %0a%3c   Service-Component=aQute.tutorial.component.World; [=\=]%0a%3c     log=org.osgi.service.log.LogService?; [=\=]%0a%3c     http=org.osgi.service.http.HttpService; [=\=]%0a%3c     PROCESSORS="xierpa.service.processor.Processor(priority>1)+"; [=\=]%0a%3c     properties:="wazaabi=true"%0a%3c     %0a%3c The previous example will result in the following service component in the resource @@OSGI-INF/aQute.tutorial.component.World.xml@@:  %0a%3c %0a%3c   %3c?xml version="1.0" encoding="utf-8" ?>%0a%3c    %3ccomponent name="aQute.tutorial.component.World">%0a%3c      %3cimplementation class="aQute.tutorial.component.World" /> %0a%3c      %3creference name="log" %0a%3c        interface="org.osgi.service.log.LogService" %0a%3c        cardinality="0..1" %0a%3c        bind="setLog" %0a%3c        unbind="unsetLog" %0a%3c        policy="dynamic" /> %0a%3c      %3creference name="http" %0a%3c        interface="org.osgi.service.http.HttpService" %0a%3c        bind="setHttp" %0a%3c        unbind="unsetHttp" />%0a%3c      %3creference name="PROCESSORS" %0a%3c        interface="xierpa.service.processor.Processor" %0a%3c        cardinality="1..n" %0a%3c        policy="dynamic" %0a%3c        target="(priority>1)" /> %0a%3c    %3c/component> %0a%3c %0a%3c The description also supports the immediate, enabled, factory, target, servicefactory, configuration-policy, activate, deactivate, and modified attributes. Refer to the Declarative Services definition for their semantics.%0a%3c %0a%3c If any feature of the V1.1 namespace is used, then bnd will declare the namespace in the @@component@@ element. A specific namespace version can be set with the @@version@@ directive.%0a%3c %0a%3c Bnd also supports setting the policy and cardinality through the following directives:%0a%3c %0a%3c   multiple:= LIST    names of references that have x..n%0a%3c   optional:= LIST    names of references that have 0..x%0a%3c   dynamic:=  LIST    names of references that are dynamic%0a%3c %0a%3c [[#macros]]%0a%3c !! Macros%0a%3c %0a%3c A simple macro processor is added to the header processing. Variables allow a single definition of a value, and the use of derivations. Each header is a macro that can be expanded. Notice that headers that do not start with an upper case character will not be copied to the manifest, so they can be used as working variables. Variables are expanded by enclosing the name of the variable in @@${%3cname>}@@ (curly braces) or @@$(%3cname>)@@ (parenthesis). Additionally, square brackets [], angled brackets %3c>, double guillemets , and single guillemets  are also allowed for brackets. If brackets are nested, that is $[replace;acaca;a(.*)a;[$1]] will return @@[cac]@@.%0a%3c %0a%3c For example:%0a%3c %0a%3c  version=1.23.87.200109111023542%0a%3c  Bundle-Version= ${version}%0a%3c  Bundle-Description= This bundle has version ${version}%0a%3c %0a%3c There are a number of built in properties that are set by bnd:%0a%3c %0a%3c ||%0a%3c ||!Property name ||!Description ||%0a%3c ||@@project@@||Name of the project. This is the name of the bnd file without the .bnd extension. If this name is bnd.bnd, then the directory name is used. ||%0a%3c ||@@project.file@@||Absolute path of the main bnd file. ||%0a%3c ||@@project.name@@||Just the name part of the file path ||%0a%3c ||@@project.dir@@||The absolute path of the directory in which the bnd file resides. ||%0a%3c %0a%3c There are also a number of macros that perform basic functions. All these functions have the following basic syntax:%0a%3c %0a%3c  macro ::= '${' function '}' %0a%3c          | '$[' function ']'%0a%3c          | '$(' function ')'%0a%3c          | '$%3c' function '>'%0a%3c          | '$' function ''%0a%3c          | '$' function ''%0a%3c  function ::= name ( ':' argument ) *%0a%3c %0a%3c ||%0a%3c ||!Function ||!Arguments ||!Description ||%0a%3c ||@@filter@@||; list ; regex ||The filter macro iterates over the given list and only includes elements that match the given regular expression (regex). The following example includes only the jar files from the list: \\%0a%3c @@list= a,b,c,d,x.jar,z.jar \\%0a%3c List= ${filter;${list};.*\\.jar}@@||%0a%3c ||@@filterout@@||; list ; regex ||The filterout macro iterates over the given list and removes elements that match the given regular expression (regex). The following example strips the jar files from the list:  \\%0a%3c @@list= a,b,c,d,x.jar,z.jar \\%0a%3c List= ${filterout:${list};.*\\.jar}@@||%0a%3c ||@@env@@||; name ||Provide the value of the given environment variable||%0a%3c ||@@sort@@||; list ||Sort the given list using string sorting collation. For example: \\%0a%3c @@List= ${sort:acme.jar, harry.jar, runner.jar, alpha.jar, bugs.jar}@@ ||%0a%3c ||@@classes@@||QUERY||Provides a query function to find classes to fullfil certain criteria. See the [[#classes|classes]] macro||%0a%3c ||@@join@@||( ; list ) * ||Joins a number of lists into one. It may seem that this can be easily accomplished by just placing two macro expansions after each other. The result of this will not be a list, unless a ',' (colon) is placed in between. However, when one of the lists is empty, the colon will be superfluous. The join handles these cases correctly. Any number of lists may be given as arguments. \\%0a%3c @@List= ${join;a,b,c;d,e,f}@@ ||%0a%3c ||@@if@@||; condition ; true ( ; false ) ? ||If the condition is not empty, the true part is returned, else the false part is returned. If not false part is supplied, the empty string is returned. The condition is trimmed before tested. For example: \\%0a%3c @@Comment: ${if;${version};Ok;Version is NOT set!!!!}@@||%0a%3c ||@@now@@||||Returns the current Date as string.  \\%0a%3c @@Created-When: ${now}@@||%0a%3c ||@@fmodified@@||; file-path-list ||Return the highest modification time of the given file path. The returned value is based on the epoch of Java, it is therefore a long.  \\%0a%3c @@Last-Modified: ${long2date;${fmodified;${files}})@@||%0a%3c ||@@long2date@@||; long ||Parse the long and turn it into a date.  \\%0a%3c @@Last-Modified: ${long2date:${fmodified:${files}})@@||%0a%3c ||@@replace@@||; list ; regex ; replacement ||Replace all elements of the list that match the regular expression regex with the replacement. The replacement can use the @@$[0-9]@@ back references defined in the regular expressions. The macro uses @@item.replaceAll(regex,replacement)@@ method to do the replacement.For example, to add a @@.jar@@ extension to all files listed, use the following: \\%0a%3c @@List = ${replace;${impls};$;.jar}@@||%0a%3c ||@@toclassname@@||; list||Replace a class path (with slashes and class at the end) to a class name (with dots).||%0a%3c ||@@toclasspath@@||; list  [ ; suffix ]||Replace a class name (with dots) to a classpath (with slashes and @@suffix@@ at the end). The default suffix is @@.class@@. The suffix may be empty||%0a%3c ||@@findname@@||; regex [ ; replacement ]  ||Find the paths to any resources that matches the regular expression, replace the name with the replacement of the regex. Notice that the regex is only executed on the name of the resource, that is, without the slashes.||%0a%3c ||@@findpath@@||; regex [ ; replacement ]  ||Find the paths to any resources that matches the regular expression, replace the path with the replacement of the regex. Notice that the regex is executed on the path of the resource, that is, with the slashes.||%0a%3c ||@@version@@||; mask ; version||This macro can modify a version by dropping parts from the end, incrementing parts, or decrementing parts. The mask is a string containing from 1 to 4 characters. The characters have the following meaning: \\%0a%3c   = the actual version part \\%0a%3c   + increment the actual version part \\%0a%3c   - decrement the actual version part \\%0a%3c For example, ${version;=+;1.2.3.q} will become 1.3.||%0a%3c %0a%3c [[#classes]]%0a%3c !!classes macro%0a%3c The classes macro provides a query function in an analyzed bundle. While analyzing, the Analyzer stores each found class on the Bundle-Classpath with some key information. A simple query language is used to query this dictionary. For example, if you want to make a manifest header with all public classes in the bundle:%0a%3c %0a%3c   Public-Classes: ${classes;PUBLIC}%0a%3c %0a%3c The query language is conjunctive, that is, all entries form an AND. For example, if you want to find all PUBLIC classes that are also not abstract you would do:%0a%3c %0a%3c   PublicConcrete-Classes: ${classes;CONCRETE}%0a%3c %0a%3c The query can also parameters. This is a pattern that must match some aspect of the class. For example, it is possible to query for classes that extend a certain base class:%0a%3c %0a%3c   Test-Cases: ${classes;CONCRETE;EXTENDS;junit.framework.TestCase}%0a%3c %0a%3c All pattern matching is based on fully qualified name and uses the globbing model.%0a%3c %0a%3c The following table specifies what query options there are:%0a%3c %0a%3c ||!Query         ||!Parameter   ||!Description||%0a%3c ||IMPLEMENTS     ||PATTERN      ||The class must implement at least one interface that matches the given pattern. This takes inheritance into account as long as intermediates can be found the classpath||%0a%3c ||EXTENDS        ||PATTERN      ||The class must implement at least one interface that matches the given pattern. This takes inheritance into account as long as intermediates can be found the classpath.||%0a%3c ||IMPORTS        ||PATTERN      ||The class must use a type from another package that matches the given pattern||%0a%3c ||NAMED          ||PATTERN      ||The class fqn must match the given pattern.||%0a%3c ||ANY            ||             ||Matches any class||%0a%3c ||VERSION        ||PATTERN      ||The class format of the given class must match the given version. The version is given as "%3cmajor>/%3cminor>", like "49/0". To select classes that are Java 6, do @@${classes;VERSION;49/*}@@||%0a%3c ||CONCRETE       ||             ||Class must not be abstract||%0a%3c ||ABSTRACT       ||             ||Class must be abstract||%0a%3c ||PUBLIC         ||             ||Class must be public||%0a%3c ||ANNOTATION     ||PATTERN      ||The class must have an annotation that matches the pattern. The set of annotations is all annotations in the class, also the annotations on fields and methods.||%0a%3c %0a%3c !!!Caveat%0a%3c bnd will attempt to use the resources on the classpath if a super class or interface that is referenced from an analyzed class is not in the class space. However, bnd does not require that all dependencies are available on the classpath. In such a case it is not possible to do a complete analysis. For example, if A extends B and B extends C then it can only be determined that A extends C if B can be analyzed.%0a%3c  %0a%3c !!Strategic%0a%3c %0a%3c [[#versionpolicy]]%0a%3c !!!Version Policy%0a%3c The version policy defines how an import is bound to a matched export when the import is not decorated with a version. Assuming that the exporter has a version, than it would be desirable to take that version, adapt it in a specific way to a range and use that as the import version. This is exactly what the @@-versionpolicy@@ allows. The value of this option is a string that will be used for the value of the import version. %0a%3c %0a%3c A hard coded string would not be very valuable, it is therefore possible to use the ${@} macro. This macro will contain the actual export version when the import version is calculated. This actual version can be processed by the @@${version}@@ macro to create a truncated or incremented version. This is best elucidated with some examples. In the following examples the export version is 1.2.3.q.%0a%3c %0a%3c ||!-versionpolicy                             ||!version||%0a%3c ||${@}                                        ||1.2.3.q||%0a%3c ||${version;==;${@}}                          ||1.2 (default)||%0a%3c ||[${version;==;${@}},${version;=+;${@}})      ||[1.2,1.3)||%0a%3c ||[${version;==;${@}},${version;+;${@}})       ||[1.2,2)||%0a%3c %0a%3c %0a%3c [[#cmd]]%0a%3c !! Command Line%0a%3c The command line tool can be invoked in several different ways:%0a%3c %0a%3c * bnd ''general-options'' ''cmd'' ''cmd-options''%0a%3c * bnd ''general-options'' ''%3cfile>.jar''%0a%3c * bnd ''general-options'' ''%3cfile>.bnd''%0a%3c %0a%3c !!! General Options%0a%3c %0a%3c ||%0a%3c ||!General Option ||!Description ||%0a%3c ||-failok ||Same as the property -failok. The current run will create a JAR file even if there were errors. ||%0a%3c ||-exceptions ||Will print the exception when the software has ran into a bad exception and bails out. Normally only a message is printed. For debugging or diagnostic reasons, the exception stack trace can be very helpful. ||%0a%3c %0a%3c !!! print ( -verify | -manifest | -list | - all ) * %3cfile>.jar +%0a%3c %0a%3c The print function will take a list of JAR file and print one or more aspect of the JAF riles. The following aspects can be added.%0a%3c %0a%3c * -verify - Verify the JAR for consistency with the specification. The print will exit with an error if the verify fails.%0a%3c * -manifest - Show the manifest%0a%3c * -list - List the entries in the JAR file%0a%3c * -all - Do all (this is the default.%0a%3c %0a%3c  bnd print -verify *.jar%0a%3c %0a%3c !!! build ( -classpath LIST | -eclipse %3cfile> | -noeclipse | -output %3cfile> ) * %3cfile>.bnd +%0a%3c %0a%3c The build function will assemble a bundle from the bnd specification. The default name of the output bundle is the name of the bnd file with a .jar extension.%0a%3c %0a%3c * -classpath - A list of JAR files and/or directories that should be placed on the class path before the calculation starts.%0a%3c * -eclipse - Parse the file as an Eclipse .classpath file, use the information to create an Eclipse's project class path. If this option is used, the default .classpath file is not read.%0a%3c * -noeclipse - Do not parse the .classpath file of an Eclipse project.%0a%3c * -output - Override the default output name of the bundle or the directory. If the output is a directory, the name will be derived from the bnd file name.%0a%3c %0a%3c  bnd build -classpath bin -noeclipse -output test.jar xyz.bnd%0a%3c %0a%3c %0a%3c [[#wrap]]%0a%3c !!! wrap ( -classpath (%3cfile>(','%3cfile>)*)-output %3cfile|dir> | -properties %3cfile> ) * \\%0a%3c   -ignoremanifest? %3cfile>.jar *%0a%3c %0a%3c The wrap command takes an existing JAR file and guesses the manifest headers that will make this JAR useful for an OSGi Service Platform. If the output file is not overridden, the name of the input file is used with a .bar extension. The default bnd file for the header calculation is:%0a%3c %0a%3c  Export-Package: * %0a%3c  Import-Package: %3cpackages inside the target jar>%0a%3c %0a%3c If the target bundle has a manifest, the headers are merged with the properties.%0a%3c %0a%3c The defaults can be overridden with a specific properties file.%0a%3c %0a%3c * -output - Set the output file or directory%0a%3c * -classpath - Sets the classpath as a comma separated list%0a%3c * -properties - Use a special property file for the manifest calculation.%0a%3c * -ignoremanifest - Do not include the manifest headers from the target bundle%0a%3c %0a%3c  bnd wrap -classpath osgi.jar *.jar%0a%3c %0a%3c !!! eclipse%0a%3c %0a%3c List the Eclipse information in the current directory.%0a%3c %0a%3c  bnd eclipse%0a%3c [[#eclipse]]%0a%3c !!Eclipse Plugin%0a%3c The bnd.jar file is a complete plugin. To install this plugin, place it in the eclipse/plugin directory (or extension directory) of your Eclipse installation and restart (!). The plugin will provides a 'Make Bundle' context menu when you select a file that ends with .bnd. Two menus are shown when you select a JAR file. You can 'Wrap JAR', turning it into a bundle with all imports and exports set (the extension will be .bar), or you can use 'Verify Bundle', and verify the bundle for compliance to the spec. Any errors or warnings are listed in a dialog box.%0a%3c  %0a%3c Additionally, the plugin registers an editor for JAR files. The editor shows the full output of the print command.%0a%3c %0a%3c [[#ant]]%0a%3c !! Ant Task%0a%3c The @@bnd.jar@@ file can also be used as an ANT task. The following example shows how you can use it from an ANT file.%0a%3c %0a%3c  %3ctarget name="build"> %0a%3c    %3ctaskdef resource="aQute/bnd/ant/taskdef.properties"%0a%3c       classpath="bnd.jar"/> %0a%3c    %3cbnd %0a%3c       classpath="src" %0a%3c       eclipse="true" %0a%3c       failok="false" %0a%3c       exceptions="true" %0a%3c       files="test.bnd"/> %0a%3c  %3c/target>%0a%3c %0a%3c You can set the following attributes:%0a%3c %0a%3c ||%0a%3c ||!Attribute ||!Description ||%0a%3c ||classpath ||Command separated list of file names. File paths are relative from the ant project file. ||%0a%3c ||eclipse ||True or false. True if the eclipse .classpath file should be read (default). ||%0a%3c ||failok ||Succeed even if there are errors. ||%0a%3c ||exceptions ||If errors occur, show the exception stack trace. ||%0a%3c ||files ||A comma separated list of bnd files ||%0a%3c ||sourcepath||A source path||%0a%3c ||output||Where the output should go||%0a%3c %0a%3c The following tasks have also been added:%0a%3c ||task name||Class||attributes||%0a%3c ||bndeclipse||EclipseTask||prefix='project.'||%0a%3c ||bndexpand||ExpandPropertiesTask||propertyFile='%3cfile>'||%0a%3c ||bndwrap||WrapTask||jars='%3clist>', output='%3cdir>', definitions='%3cdir>', classpath='%3cfile-list>'||%0a%3c %0a%3c [[#maven]]%0a%3c !!Maven%0a%3c The Maven plugin is described at [[http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html%0a%3c |Felix maven plugin]]. Defaults for Maven are:%0a%3c %0a%3c  Bundle-SymbolicName: %3cgroupId>.%3cartifactId>%0a%3c  Bundle-Name:         project.getName();%0a%3c  Bundle-Version:      %3cversion>%0a%3c  Import-Package:      *%0a%3c  Export-Package:      %3cgroupId>.%3cartifactId>.* (unless Private-package is set)%0a%3c  Bundle-Description:  project.getDescription()%0a%3c  Bundle-License:      project.getLicenses())%0a%3c  Bundle-Vendor:       project.getOrganization();%0a%3c  Include-Resource:    src/main/resources%0a%3c %0a%3c !! Errors and Warnings%0a%3c %0a%3c There are many errors and warnings. The messages should be self explanatory.%0a\ No newline at end of file%0a
host:1287241934=90.41.247.141
